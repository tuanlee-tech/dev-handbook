# üìÖ NG√ÄY 36: Context API - Fundamentals

## üéØ M·ª•c ti√™u h·ªçc t·∫≠p (5 ph√∫t)

- [ ] Hi·ªÉu v·∫•n ƒë·ªÅ Props Drilling v√† t·∫°i sao c·∫ßn Context
- [ ] N·∫Øm v·ªØng c√°ch t·∫°o v√† s·ª≠ d·ª•ng Context (createContext, Provider, useContext)
- [ ] Bi·∫øt khi n√†o N√äN v√† KH√îNG N√äN d√πng Context
- [ ] Tr√°nh ƒë∆∞·ª£c c√°c l·ªói ph·ªï bi·∫øn khi l√†m vi·ªác v·ªõi Context

## ü§î Ki·ªÉm tra ƒë·∫ßu v√†o (5 ph√∫t)

1. **useState v√† useReducer kh√°c nhau nh∆∞ th·∫ø n√†o? Khi n√†o d√πng useReducer?**
2. **Custom hook l√† g√¨? T·∫°i sao ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng "use"?**
3. **Component re-render khi n√†o? State change c√≥ trigger re-render kh√¥ng?**

---

## üìñ PH·∫¶N 1: GI·ªöI THI·ªÜU KH√ÅI NI·ªÜM (30 ph√∫t)

### 1.1 V·∫•n ƒê·ªÅ Th·ª±c T·∫ø

H√£y t∆∞·ªüng t∆∞·ª£ng b·∫°n ƒëang x√¢y d·ª±ng m·ªôt ·ª©ng d·ª•ng e-commerce v·ªõi theme switching (s√°ng/t·ªëi):

```jsx
/**
 * ‚ùå PROPS DRILLING PROBLEM
 * Theme ph·∫£i truy·ªÅn qua 5 t·∫ßng component
 */

// App.jsx
function App() {
  const [theme, setTheme] = useState('light');

  return (
    <Layout
      theme={theme}
      setTheme={setTheme}
    />
  );
}

// Layout.jsx
function Layout({ theme, setTheme }) {
  return (
    <div>
      <Header
        theme={theme}
        setTheme={setTheme}
      />
      <Main theme={theme} />
    </div>
  );
}

// Header.jsx
function Header({ theme, setTheme }) {
  return (
    <Navigation
      theme={theme}
      setTheme={setTheme}
    />
  );
}

// Navigation.jsx
function Navigation({ theme, setTheme }) {
  return (
    <ThemeToggle
      theme={theme}
      setTheme={setTheme}
    />
  );
}

// ThemeToggle.jsx - Component TH·ª∞C S·ª∞ c·∫ßn d√πng!
function ThemeToggle({ theme, setTheme }) {
  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      Current: {theme}
    </button>
  );
}
```

**V·∫•n ƒë·ªÅ:**

- Layout, Header, Navigation KH√îNG d√πng theme nh∆∞ng ph·∫£i nh·∫≠n props
- Kh√≥ maintain: Th√™m props m·ªõi ph·∫£i s·ª≠a nhi·ªÅu file
- D·ªÖ qu√™n truy·ªÅn props ‚Üí bug
- Component kh√¥ng reusable (b·ªã couple v·ªõi props)

### 1.2 Gi·∫£i Ph√°p

**Context API** - C√°ch chia s·∫ª data xuy√™n su·ªët component tree m√† kh√¥ng c·∫ßn props:

```jsx
/**
 * ‚úÖ CONTEXT SOLUTION
 * Theme c√≥ th·ªÉ truy c·∫≠p tr·ª±c ti·∫øp t·ª´ b·∫•t k·ª≥ component n√†o
 */

// 1. T·∫°o Context
const ThemeContext = createContext();

// 2. App cung c·∫•p gi√° tr·ªã qua Provider
function App() {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <Layout />
    </ThemeContext.Provider>
  );
}

// 3. Layout, Header, Navigation KH√îNG c·∫ßn props n·ªØa!
function Layout() {
  return (
    <div>
      <Header />
      <Main />
    </div>
  );
}

function Header() {
  return <Navigation />;
}

function Navigation() {
  return <ThemeToggle />;
}

// 4. ThemeToggle truy c·∫≠p Context tr·ª±c ti·∫øp
function ThemeToggle() {
  const { theme, setTheme } = useContext(ThemeContext);

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      Current: {theme}
    </button>
  );
}
```

**L·ª£i √≠ch:**

- ‚úÖ Kh√¥ng props drilling
- ‚úÖ Components ƒë·ªôc l·∫≠p h∆°n
- ‚úÖ D·ªÖ th√™m/s·ª≠a data
- ‚úÖ Code cleaner

### 1.3 Mental Model

```
PROPS DRILLING:
App (theme)
  ‚Üí Layout (theme)
      ‚Üí Header (theme)
          ‚Üí Navigation (theme)
              ‚Üí ThemeToggle (theme) ‚Üê Ch·ªâ component n√†y d√πng!

CONTEXT:
App (Provider v·ªõi theme)
  ‚Üí Layout
      ‚Üí Header
          ‚Üí Navigation
              ‚Üí ThemeToggle (useContext) ‚Üê L·∫•y tr·ª±c ti·∫øp t·ª´ Provider!

T∆∞∆°ng t·ª± nh∆∞: BROADCAST RADIO
- Provider = Radio Station (ph√°t s√≥ng)
- Context Value = S√≥ng radio
- useContext = Radio Receiver (b·∫Øt s√≥ng)
‚Üí Kh√¥ng c·∫ßn d√¢y d·∫´n (props) gi·ªØa station v√† receiver!
```

### 1.4 Hi·ªÉu L·∫ßm Ph·ªï Bi·∫øn

‚ùå **"Context thay th·∫ø cho props"**
‚Üí ‚úÖ Context CH·ªà d√πng khi data c·∫ßn share nhi·ªÅu n∆°i. Props v·∫´n l√† first choice!

‚ùå **"Context l√† state management library"**
‚Üí ‚úÖ Context ch·ªâ l√† TRANSPORT mechanism. State v·∫´n d√πng useState/useReducer!

‚ùå **"Context l√†m app nhanh h∆°n"**
‚Üí ‚úÖ Context c√≥ th·ªÉ G√ÇY CH·∫¨M n·∫øu d√πng sai (s·∫Ω h·ªçc ·ªü Ng√†y 38)

‚ùå **"C·∫ßn 1 Context duy nh·∫•t cho to√†n app"**
‚Üí ‚úÖ N√™n t√°ch nhi·ªÅu Context cho c√°c concerns kh√°c nhau

---

## üíª PH·∫¶N 2: LIVE CODING (45 ph√∫t)

### Demo 1: Pattern C∆° B·∫£n - Theme Switcher ‚≠ê

```jsx
/**
 * üéØ Basic Context Pattern
 * - createContext
 * - Provider
 * - useContext
 */

import { createContext, useContext, useState } from 'react';

// Step 1: T·∫°o Context (ngo√†i component!)
const ThemeContext = createContext();

// Step 2: Provider Component
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme((prev) => (prev === 'light' ? 'dark' : 'light'));
  };

  // Value object ch·ª©a state + functions
  const value = {
    theme,
    toggleTheme,
  };

  return (
    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
  );
}

// Step 3: Consumer Components
function Header() {
  const { theme } = useContext(ThemeContext);

  return (
    <header
      style={{
        background: theme === 'light' ? '#fff' : '#333',
        color: theme === 'light' ? '#000' : '#fff',
      }}
    >
      <h1>My App</h1>
      <ThemeToggle />
    </header>
  );
}

function ThemeToggle() {
  const { theme, toggleTheme } = useContext(ThemeContext);

  return (
    <button onClick={toggleTheme}>
      {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'} Toggle Theme
    </button>
  );
}

function Content() {
  const { theme } = useContext(ThemeContext);

  return (
    <main
      style={{
        background: theme === 'light' ? '#f0f0f0' : '#222',
        color: theme === 'light' ? '#000' : '#fff',
        minHeight: '200px',
        padding: '20px',
      }}
    >
      <p>This content adapts to theme!</p>
    </main>
  );
}

// Step 4: App setup
function App() {
  return (
    <ThemeProvider>
      <Header />
      <Content />
    </ThemeProvider>
  );
}

// Render: Header v√† Content t·ª± ƒë·ªông nh·∫≠n theme, kh√¥ng c·∫ßn props!
```

### Demo 2: K·ªãch B·∫£n Th·ª±c T·∫ø - User Authentication ‚≠ê‚≠ê

```jsx
/**
 * üéØ Real-world Pattern: Auth Context
 * - Login/Logout state
 * - Loading state
 * - Error handling
 */

import { createContext, useContext, useState } from 'react';

const AuthContext = createContext();

function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const login = async (email, password) => {
    setLoading(true);
    setError(null);

    try {
      // Gi·∫£ l·∫≠p API call
      await new Promise((resolve) => setTimeout(resolve, 1000));

      if (email === 'admin@test.com' && password === '123') {
        setUser({ email, name: 'Admin User' });
      } else {
        throw new Error('Invalid credentials');
      }
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  const logout = () => {
    setUser(null);
    setError(null);
  };

  const value = {
    user,
    login,
    logout,
    loading,
    error,
    isAuthenticated: !!user,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

// Custom hook ƒë·ªÉ d√πng Auth context
function useAuth() {
  const context = useContext(AuthContext);

  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }

  return context;
}

// Components
function LoginForm() {
  const { login, loading, error } = useAuth();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    login(email, password);
  };

  return (
    <form onSubmit={handleSubmit}>
      <h2>Login</h2>

      {error && <div style={{ color: 'red' }}>{error}</div>}

      <div>
        <input
          type='email'
          placeholder='Email'
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          disabled={loading}
        />
      </div>

      <div>
        <input
          type='password'
          placeholder='Password'
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          disabled={loading}
        />
      </div>

      <button
        type='submit'
        disabled={loading}
      >
        {loading ? 'Logging in...' : 'Login'}
      </button>

      <p style={{ fontSize: '12px', color: '#666' }}>
        Hint: admin@test.com / 123
      </p>
    </form>
  );
}

function UserProfile() {
  const { user, logout } = useAuth();

  return (
    <div>
      <h2>Welcome, {user.name}!</h2>
      <p>Email: {user.email}</p>
      <button onClick={logout}>Logout</button>
    </div>
  );
}

function Dashboard() {
  const { isAuthenticated } = useAuth();

  return <div>{isAuthenticated ? <UserProfile /> : <LoginForm />}</div>;
}

function App() {
  return (
    <AuthProvider>
      <Dashboard />
    </AuthProvider>
  );
}

// Result: Login form ‚Üí Enter credentials ‚Üí Show user profile
```

### Demo 3: Edge Cases - Context v·ªõi Default Value ‚≠ê‚≠ê‚≠ê

```jsx
/**
 * üéØ Edge Cases
 * - Default context value
 * - Missing Provider detection
 * - Multiple Providers
 */

import { createContext, useContext, useState } from 'react';

// ‚ùå BAD: No default value
const BadContext = createContext();

// ‚úÖ GOOD: Default value (fallback)
const LanguageContext = createContext({
  language: 'en',
  setLanguage: () => console.warn('No LanguageProvider found'),
});

function LanguageProvider({ children }) {
  const [language, setLanguage] = useState('en');

  return (
    <LanguageContext.Provider value={{ language, setLanguage }}>
      {children}
    </LanguageContext.Provider>
  );
}

// Custom hook v·ªõi error handling
function useLanguage() {
  const context = useContext(LanguageContext);

  // Edge Case 1: Component outside Provider
  if (!context) {
    throw new Error('useLanguage must be used within LanguageProvider');
  }

  return context;
}

// Edge Case 2: Multiple Providers (nested)
function NestedProvidersDemo() {
  return (
    <LanguageProvider>
      <div>
        <ComponentA />

        {/* Nested Provider v·ªõi gi√° tr·ªã kh√°c */}
        <LanguageProvider>
          <ComponentB />
        </LanguageProvider>
      </div>
    </LanguageProvider>
  );
}

function ComponentA() {
  const { language } = useLanguage();
  return <div>Component A: {language}</div>; // 'en' from outer Provider
}

function ComponentB() {
  const { language, setLanguage } = useLanguage();

  // Component n√†y d√πng inner Provider
  return (
    <div>
      Component B: {language}
      <button onClick={() => setLanguage('vi')}>Change to Vietnamese</button>
    </div>
  );
}

// Edge Case 3: Conditional Provider
function ConditionalProviderDemo() {
  const [enableProvider, setEnableProvider] = useState(false);

  const content = <LanguageDisplay />;

  return (
    <div>
      <button onClick={() => setEnableProvider(!enableProvider)}>
        Toggle Provider: {enableProvider ? 'ON' : 'OFF'}
      </button>

      {enableProvider ? (
        <LanguageProvider>{content}</LanguageProvider>
      ) : (
        content // D√πng default value!
      )}
    </div>
  );
}

function LanguageDisplay() {
  const { language } = useContext(LanguageContext);

  return (
    <div>
      Current Language: {language}
      {/* N·∫øu kh√¥ng c√≥ Provider, s·∫Ω d√πng default value 'en' */}
    </div>
  );
}
```

---

## üî® PH·∫¶N 3: B√ÄI T·∫¨P TH·ª∞C H√ÄNH (60 ph√∫t)

### ‚≠ê Level 1: Counter v·ªõi Context (15 ph√∫t)

```jsx
/**
 * üéØ M·ª•c ti√™u: T·∫°o Context ƒë·∫ßu ti√™n
 * ‚è±Ô∏è Th·ªùi gian: 15 ph√∫t
 * üö´ KH√îNG d√πng: useReducer, multiple contexts
 *
 * Requirements:
 * 1. T·∫°o CounterContext v·ªõi createContext
 * 2. CounterProvider qu·∫£n l√Ω count state
 * 3. CounterDisplay hi·ªÉn th·ªã count
 * 4. CounterButtons c√≥ n√∫t +1, -1, Reset
 * 5. T·∫•t c·∫£ components ƒë·ªÅu d√πng useContext
 *
 * üí° G·ª£i √Ω: Provider value n√™n l√† object { count, increment, decrement, reset }
 */

// ‚ùå C√°ch SAI:
// - Truy·ªÅn count qua props thay v√¨ Context
// - T·∫°o Context b√™n trong component (ph·∫£i ·ªü ngo√†i!)
// - Kh√¥ng wrap App b·∫±ng Provider
// - useContext() m√† kh√¥ng c√≥ Provider

// ‚úÖ C√°ch ƒê√öNG: Xem solution

// üéØ NHI·ªÜM V·ª§ C·ª¶A B·∫†N:
// TODO: Implement CounterContext
// TODO: Implement CounterProvider
// TODO: Implement CounterDisplay (ch·ªâ hi·ªÉn th·ªã)
// TODO: Implement CounterButtons (c√°c n√∫t ƒëi·ªÅu khi·ªÉn)
// TODO: K·∫øt n·ªëi trong App
```

<details>
<summary>üí° Solution</summary>

```jsx
import { createContext, useContext, useState } from 'react';

/**
 * Counter Context - Basic pattern
 */

// 1. Create Context
const CounterContext = createContext();

// 2. Provider Component
function CounterProvider({ children }) {
  const [count, setCount] = useState(0);

  const increment = () => setCount((prev) => prev + 1);
  const decrement = () => setCount((prev) => prev - 1);
  const reset = () => setCount(0);

  const value = {
    count,
    increment,
    decrement,
    reset,
  };

  return (
    <CounterContext.Provider value={value}>{children}</CounterContext.Provider>
  );
}

// 3. Custom hook
function useCounter() {
  const context = useContext(CounterContext);

  if (!context) {
    throw new Error('useCounter must be used within CounterProvider');
  }

  return context;
}

// 4. Consumer Components
function CounterDisplay() {
  const { count } = useCounter();

  return (
    <div style={{ fontSize: '48px', textAlign: 'center', margin: '20px' }}>
      {count}
    </div>
  );
}

function CounterButtons() {
  const { increment, decrement, reset } = useCounter();

  return (
    <div style={{ textAlign: 'center' }}>
      <button onClick={decrement}>-1</button>
      <button
        onClick={reset}
        style={{ margin: '0 10px' }}
      >
        Reset
      </button>
      <button onClick={increment}>+1</button>
    </div>
  );
}

// 5. App
function App() {
  return (
    <CounterProvider>
      <h1 style={{ textAlign: 'center' }}>Counter v·ªõi Context</h1>
      <CounterDisplay />
      <CounterButtons />
    </CounterProvider>
  );
}

// Result: Counter ho·∫°t ƒë·ªông m∆∞·ª£t m√†, kh√¥ng c·∫ßn props drilling
```

</details>

### ‚≠ê‚≠ê Level 2: Shopping Cart Context (25 ph√∫t)

```jsx
/**
 * üéØ M·ª•c ti√™u: Nh·∫≠n bi·∫øt khi n√†o n√™n d√πng Context
 * ‚è±Ô∏è Th·ªùi gian: 25 ph√∫t
 *
 * Scenario: E-commerce app c·∫ßn shopping cart
 * - Gi·ªè h√†ng hi·ªÉn th·ªã ·ªü Header (s·ªë l∆∞·ª£ng items)
 * - Product list ·ªü Main
 * - Checkout button ·ªü Footer
 *
 * ü§î PH√ÇN T√çCH:
 *
 * Approach A: Props Drilling
 * Pros: Simple, explicit data flow
 * Cons: Cart ph·∫£i pass qua Header ‚Üí Main ‚Üí ProductCard
 *       Nhi·ªÅu components kh√¥ng d√πng cart ph·∫£i nh·∫≠n props
 *
 * Approach B: Context API
 * Pros: Components l·∫•y cart tr·ª±c ti·∫øp
 *       D·ªÖ th√™m t√≠nh nƒÉng m·ªõi
 * Cons: ·∫®n data flow (kh√≥ trace)
 *       Re-render issues n·∫øu kh√¥ng optimize
 *
 * üí≠ B·∫†N CH·ªåN G√å V√Ä T·∫†I SAO?
 * (Document quy·∫øt ƒë·ªãnh trong comment)
 *
 * Requirements:
 * 1. CartContext qu·∫£n l√Ω items[]
 * 2. addToCart(product)
 * 3. removeFromCart(productId)
 * 4. getTotalItems() - t·ªïng s·ªë items
 * 5. getTotalPrice() - t·ªïng gi√°
 */

// üéØ NHI·ªÜM V·ª§:
// TODO: Document approach b·∫°n ch·ªçn (A ho·∫∑c B) v√† WHY
// TODO: Implement approach ƒë√£ ch·ªçn
// TODO: Test v·ªõi √≠t nh·∫•t 3 products
```

<details>
<summary>üí° Solution</summary>

```jsx
import { createContext, useContext, useState } from 'react';

/**
 * DECISION: Ch·ªçn Context API (Approach B)
 *
 * RATIONALE:
 * - Cart data c·∫ßn ·ªü nhi·ªÅu n∆°i: Header (badge), ProductList (add button), Footer (checkout)
 * - Tr√°nh props drilling qua Layout components
 * - Cart l√† global state, ph√π h·ª£p v·ªõi Context
 * - Trade-off ch·∫•p nh·∫≠n: C·∫ßn optimize re-render sau (Ng√†y 38)
 */

// 1. Create CartContext
const CartContext = createContext();

function CartProvider({ children }) {
  const [items, setItems] = useState([]);

  // Add item (ho·∫∑c tƒÉng quantity n·∫øu ƒë√£ c√≥)
  const addToCart = (product) => {
    setItems((prev) => {
      const existingItem = prev.find((item) => item.id === product.id);

      if (existingItem) {
        // TƒÉng quantity
        return prev.map((item) =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item,
        );
      }

      // Th√™m m·ªõi
      return [...prev, { ...product, quantity: 1 }];
    });
  };

  const removeFromCart = (productId) => {
    setItems((prev) => prev.filter((item) => item.id !== productId));
  };

  const getTotalItems = () => {
    return items.reduce((total, item) => total + item.quantity, 0);
  };

  const getTotalPrice = () => {
    return items.reduce((total, item) => total + item.price * item.quantity, 0);
  };

  const value = {
    items,
    addToCart,
    removeFromCart,
    getTotalItems,
    getTotalPrice,
  };

  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;
}

function useCart() {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within CartProvider');
  }
  return context;
}

// 2. Components
function Header() {
  const { getTotalItems } = useCart();

  return (
    <header style={{ borderBottom: '1px solid #ccc', padding: '10px' }}>
      <h1 style={{ display: 'inline' }}>My Shop</h1>
      <span style={{ float: 'right', fontSize: '20px' }}>
        üõí {getTotalItems()}
      </span>
    </header>
  );
}

function ProductCard({ product }) {
  const { addToCart } = useCart();

  return (
    <div style={{ border: '1px solid #ddd', padding: '10px', margin: '10px' }}>
      <h3>{product.name}</h3>
      <p>${product.price}</p>
      <button onClick={() => addToCart(product)}>Add to Cart</button>
    </div>
  );
}

function ProductList() {
  const products = [
    { id: 1, name: 'Laptop', price: 999 },
    { id: 2, name: 'Mouse', price: 29 },
    { id: 3, name: 'Keyboard', price: 79 },
  ];

  return (
    <div>
      <h2>Products</h2>
      {products.map((product) => (
        <ProductCard
          key={product.id}
          product={product}
        />
      ))}
    </div>
  );
}

function CartSummary() {
  const { items, removeFromCart, getTotalPrice } = useCart();

  if (items.length === 0) {
    return <p>Cart is empty</p>;
  }

  return (
    <div
      style={{
        borderTop: '1px solid #ccc',
        padding: '10px',
        marginTop: '20px',
      }}
    >
      <h2>Cart Summary</h2>
      {items.map((item) => (
        <div
          key={item.id}
          style={{ marginBottom: '10px' }}
        >
          <span>
            {item.name} x{item.quantity} - ${item.price * item.quantity}
          </span>
          <button
            onClick={() => removeFromCart(item.id)}
            style={{ marginLeft: '10px' }}
          >
            Remove
          </button>
        </div>
      ))}
      <h3>Total: ${getTotalPrice()}</h3>
    </div>
  );
}

function App() {
  return (
    <CartProvider>
      <Header />
      <ProductList />
      <CartSummary />
    </CartProvider>
  );
}

// Result: Header badge, ProductList, CartSummary ƒë·ªÅu access cart kh√¥ng c·∫ßn props
```

</details>

### ‚≠ê‚≠ê‚≠ê Level 3: Multi-language App (40 ph√∫t)

```jsx
/**
 * üéØ M·ª•c ti√™u: K·∫øt h·ª£p Context v·ªõi complex logic
 * ‚è±Ô∏è Th·ªùi gian: 40 ph√∫t
 *
 * üìã Product Requirements:
 * User Story: "L√† user, t√¥i mu·ªën ƒë·ªïi ng√¥n ng·ªØ app (EN/VI)
 *              ƒë·ªÉ xem n·ªôi dung b·∫±ng ng√¥n ng·ªØ quen thu·ªôc"
 *
 * ‚úÖ Acceptance Criteria:
 * - [ ] Language selector ·ªü Header
 * - [ ] To√†n b·ªô text thay ƒë·ªïi theo ng√¥n ng·ªØ
 * - [ ] Default language: 'en'
 * - [ ] H·ªó tr·ª£: English, Ti·∫øng Vi·ªát
 * - [ ] Translations object cho t·∫•t c·∫£ text
 *
 * üé® Technical Constraints:
 * - D√πng Context ƒë·ªÉ share language state
 * - Custom hook useTranslation() ƒë·ªÉ get text
 * - Translations object c√≥ nested structure
 *
 * üö® Edge Cases c·∫ßn handle:
 * - Missing translation key ‚Üí fallback to key name
 * - Unknown language ‚Üí fallback to 'en'
 *
 * üìù Implementation Checklist:
 * - [ ] LanguageContext v·ªõi translations
 * - [ ] LanguageProvider v·ªõi state
 * - [ ] useTranslation() hook
 * - [ ] LanguageSelector component
 * - [ ] √çt nh·∫•t 3 components d√πng translations
 */
```

<details>
<summary>üí° Solution</summary>

```jsx
import { createContext, useContext, useState } from 'react';

/**
 * Multi-language App v·ªõi Context
 * Supports: EN, VI
 */

// 1. Translations data
const translations = {
  en: {
    header: {
      title: 'My Application',
      language: 'Language',
    },
    home: {
      welcome: 'Welcome',
      description: 'This is a multi-language application demo',
      currentLang: 'Current language',
    },
    product: {
      title: 'Products',
      addToCart: 'Add to Cart',
      price: 'Price',
      inStock: 'In Stock',
      outOfStock: 'Out of Stock',
    },
    footer: {
      copyright: '¬© 2024 All rights reserved',
      contact: 'Contact Us',
    },
  },
  vi: {
    header: {
      title: '·ª®ng D·ª•ng C·ªßa T√¥i',
      language: 'Ng√¥n ng·ªØ',
    },
    home: {
      welcome: 'Ch√†o m·ª´ng',
      description: 'ƒê√¢y l√† demo ·ª©ng d·ª•ng ƒëa ng√¥n ng·ªØ',
      currentLang: 'Ng√¥n ng·ªØ hi·ªán t·∫°i',
    },
    product: {
      title: 'S·∫£n Ph·∫©m',
      addToCart: 'Th√™m v√†o Gi·ªè',
      price: 'Gi√°',
      inStock: 'C√≤n h√†ng',
      outOfStock: 'H·∫øt h√†ng',
    },
    footer: {
      copyright: '¬© 2024 B·∫£n quy·ªÅn thu·ªôc v·ªÅ',
      contact: 'Li√™n H·ªá',
    },
  },
};

// 2. Create Context
const LanguageContext = createContext();

function LanguageProvider({ children }) {
  const [language, setLanguage] = useState('en');

  const changeLanguage = (lang) => {
    if (translations[lang]) {
      setLanguage(lang);
    } else {
      console.warn(`Language '${lang}' not supported, fallback to 'en'`);
      setLanguage('en');
    }
  };

  // Helper function ƒë·ªÉ l·∫•y nested translation
  const t = (key) => {
    const keys = key.split('.');
    let value = translations[language];

    for (const k of keys) {
      if (value && value[k]) {
        value = value[k];
      } else {
        // Fallback: return key n·∫øu kh√¥ng t√¨m th·∫•y
        console.warn(`Translation missing: ${key} for language ${language}`);
        return key;
      }
    }

    return value;
  };

  const value = {
    language,
    changeLanguage,
    t,
  };

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
}

// 3. Custom hook
function useTranslation() {
  const context = useContext(LanguageContext);

  if (!context) {
    throw new Error('useTranslation must be used within LanguageProvider');
  }

  return context;
}

// 4. Components
function LanguageSelector() {
  const { language, changeLanguage, t } = useTranslation();

  return (
    <div style={{ float: 'right' }}>
      <label>{t('header.language')}: </label>
      <select
        value={language}
        onChange={(e) => changeLanguage(e.target.value)}
      >
        <option value='en'>English</option>
        <option value='vi'>Ti·∫øng Vi·ªát</option>
      </select>
    </div>
  );
}

function Header() {
  const { t } = useTranslation();

  return (
    <header style={{ borderBottom: '2px solid #333', padding: '15px' }}>
      <h1 style={{ display: 'inline' }}>{t('header.title')}</h1>
      <LanguageSelector />
    </header>
  );
}

function Home() {
  const { t, language } = useTranslation();

  return (
    <div style={{ padding: '20px' }}>
      <h2>{t('home.welcome')}!</h2>
      <p>{t('home.description')}</p>
      <p>
        <strong>{t('home.currentLang')}:</strong> {language.toUpperCase()}
      </p>
    </div>
  );
}

function ProductCard({ product }) {
  const { t } = useTranslation();

  return (
    <div
      style={{
        border: '1px solid #ddd',
        padding: '15px',
        margin: '10px',
        borderRadius: '5px',
      }}
    >
      <h3>{product.name}</h3>
      <p>
        <strong>{t('product.price')}:</strong> ${product.price}
      </p>
      <p>
        {product.inStock
          ? `‚úÖ ${t('product.inStock')}`
          : `‚ùå ${t('product.outOfStock')}`}
      </p>
      <button>{t('product.addToCart')}</button>
    </div>
  );
}

function Products() {
  const { t } = useTranslation();

  const products = [
    { id: 1, name: 'Laptop', price: 999, inStock: true },
    { id: 2, name: 'Mouse', price: 29, inStock: true },
    { id: 3, name: 'Monitor', price: 399, inStock: false },
  ];

  return (
    <div style={{ padding: '20px' }}>
      <h2>{t('product.title')}</h2>
      {products.map((product) => (
        <ProductCard
          key={product.id}
          product={product}
        />
      ))}
    </div>
  );
}

function Footer() {
  const { t } = useTranslation();

  return (
    <footer
      style={{
        borderTop: '2px solid #333',
        padding: '15px',
        marginTop: '20px',
        textAlign: 'center',
      }}
    >
      <p>{t('footer.copyright')}</p>
      <p>{t('footer.contact')}</p>
    </footer>
  );
}

function App() {
  return (
    <LanguageProvider>
      <Header />
      <Home />
      <Products />
      <Footer />
    </LanguageProvider>
  );
}

// Result: Select ng√¥n ng·ªØ ‚Üí To√†n b·ªô app thay ƒë·ªïi text
// Edge cases:
// - Ch·ªçn unsupported language ‚Üí fallback to 'en'
// - Missing translation key ‚Üí show key name + warning
```

</details>

### ‚≠ê‚≠ê‚≠ê‚≠ê Level 4: Settings Manager v·ªõi Multiple Contexts (60 ph√∫t)

```jsx
/**
 * üéØ M·ª•c ti√™u: Qu·∫£n l√Ω multiple contexts
 * ‚è±Ô∏è Th·ªùi gian: 60 ph√∫t
 *
 * üèóÔ∏è PHASE 1: Research & Design (20 ph√∫t)
 *
 * Nhi·ªám v·ª•:
 * 1. So s√°nh 3 approaches:
 *    - Single Context cho t·∫•t c·∫£ settings
 *    - Multiple Contexts (Theme, Language, User Preferences)
 *    - Nested Contexts
 *
 * 2. Document pros/cons m·ªói approach
 *
 * 3. Ch·ªçn approach ph√π h·ª£p nh·∫•t
 *
 * 4. Vi·∫øt ADR (Architecture Decision Record)
 *
 * ADR Template:
 * - Context: App c·∫ßn qu·∫£n l√Ω theme, language, fontSize, notifications
 * - Decision: Approach ƒë√£ ch·ªçn
 * - Rationale: T·∫°i sao ch·ªçn approach n√†y
 * - Consequences: Trade-offs accepted
 * - Alternatives Considered: C√°c options kh√°c
 *
 * üíª PHASE 2: Implementation (30 ph√∫t)
 *
 * Requirements:
 * - ThemeContext: light/dark mode
 * - LanguageContext: en/vi
 * - SettingsContext: fontSize, notifications enabled/disabled
 * - Settings page ƒë·ªÉ control t·∫•t c·∫£
 * - Preview page hi·ªÉn th·ªã t·∫•t c·∫£ settings
 *
 * üß™ PHASE 3: Testing (10 ph√∫t)
 * - [ ] Change theme ‚Üí UI updates
 * - [ ] Change language ‚Üí text updates
 * - [ ] Change fontSize ‚Üí text size updates
 * - [ ] Toggle notifications ‚Üí state updates
 * - [ ] Multiple contexts kh√¥ng conflict
 */
```

<details>
<summary>üí° Solution</summary>

```jsx
import { createContext, useContext, useState } from 'react';

/**
 * ADR: Settings Manager Architecture
 *
 * CONTEXT:
 * App c·∫ßn qu·∫£n l√Ω: theme, language, fontSize, notifications
 * M·ªói setting ƒë·ªôc l·∫≠p, c√≥ th·ªÉ thay ƒë·ªïi ri√™ng
 *
 * DECISION: Multiple Contexts (Separated Concerns)
 * - ThemeContext
 * - LanguageContext
 * - PreferencesContext (fontSize, notifications)
 *
 * RATIONALE:
 * 1. Separation of Concerns: M·ªói context c√≥ 1 responsibility
 * 2. Performance: Component ch·ªâ re-render khi context n√≥ d√πng thay ƒë·ªïi
 * 3. Reusability: ThemeContext c√≥ th·ªÉ d√πng trong app kh√°c
 * 4. Testing: D·ªÖ test t·ª´ng context ri√™ng
 *
 * CONSEQUENCES (Trade-offs):
 * - More boilerplate code (3 contexts thay v√¨ 1)
 * - Provider nesting (ph·∫£i wrap 3 l·∫ßn)
 * - Ph·∫£i coordinate gi·ªØa contexts n·∫øu c√≥ dependencies
 *
 * ALTERNATIVES CONSIDERED:
 * 1. Single Context: ƒê∆°n gi·∫£n h∆°n, nh∆∞ng m·ªçi change trigger re-render to√†n b·ªô
 * 2. Nested Contexts: Ph·ª©c t·∫°p, kh√¥ng c·∫ßn thi·∫øt cho use case n√†y
 */

// 1. Theme Context
const ThemeContext = createContext();

function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme((prev) => (prev === 'light' ? 'dark' : 'light'));
  };

  const value = { theme, toggleTheme };

  return (
    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
  );
}

function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) throw new Error('useTheme must be used within ThemeProvider');
  return context;
}

// 2. Language Context
const LanguageContext = createContext();

const translations = {
  en: {
    settings: 'Settings',
    theme: 'Theme',
    language: 'Language',
    fontSize: 'Font Size',
    notifications: 'Notifications',
    preview: 'Preview',
    sampleText: 'This is sample text to preview settings',
  },
  vi: {
    settings: 'C√†i ƒê·∫∑t',
    theme: 'Ch·ªß ƒê·ªÅ',
    language: 'Ng√¥n Ng·ªØ',
    fontSize: 'C·ª° Ch·ªØ',
    notifications: 'Th√¥ng B√°o',
    preview: 'Xem Tr∆∞·ªõc',
    sampleText: 'ƒê√¢y l√† vƒÉn b·∫£n m·∫´u ƒë·ªÉ xem tr∆∞·ªõc c√†i ƒë·∫∑t',
  },
};

function LanguageProvider({ children }) {
  const [language, setLanguage] = useState('en');

  const t = (key) => translations[language]?.[key] || key;

  const value = { language, setLanguage, t };

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
}

function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context)
    throw new Error('useLanguage must be used within LanguageProvider');
  return context;
}

// 3. Preferences Context
const PreferencesContext = createContext();

function PreferencesProvider({ children }) {
  const [fontSize, setFontSize] = useState('medium');
  const [notificationsEnabled, setNotificationsEnabled] = useState(true);

  const fontSizeMap = {
    small: '14px',
    medium: '16px',
    large: '20px',
  };

  const value = {
    fontSize,
    setFontSize,
    fontSizeValue: fontSizeMap[fontSize],
    notificationsEnabled,
    toggleNotifications: () => setNotificationsEnabled((prev) => !prev),
  };

  return (
    <PreferencesContext.Provider value={value}>
      {children}
    </PreferencesContext.Provider>
  );
}

function usePreferences() {
  const context = useContext(PreferencesContext);
  if (!context)
    throw new Error('usePreferences must be used within PreferencesProvider');
  return context;
}

// 4. Combined Provider (convenience)
function AppProviders({ children }) {
  return (
    <ThemeProvider>
      <LanguageProvider>
        <PreferencesProvider>{children}</PreferencesProvider>
      </LanguageProvider>
    </ThemeProvider>
  );
}

// 5. Components
function SettingsPanel() {
  const { theme, toggleTheme } = useTheme();
  const { language, setLanguage, t } = useLanguage();
  const { fontSize, setFontSize, notificationsEnabled, toggleNotifications } =
    usePreferences();

  return (
    <div
      style={{
        padding: '20px',
        background: theme === 'light' ? '#f5f5f5' : '#333',
        color: theme === 'light' ? '#000' : '#fff',
        borderRadius: '8px',
      }}
    >
      <h2>{t('settings')}</h2>

      {/* Theme */}
      <div style={{ marginBottom: '15px' }}>
        <label>{t('theme')}: </label>
        <button onClick={toggleTheme}>
          {theme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light'}
        </button>
      </div>

      {/* Language */}
      <div style={{ marginBottom: '15px' }}>
        <label>{t('language')}: </label>
        <select
          value={language}
          onChange={(e) => setLanguage(e.target.value)}
        >
          <option value='en'>English</option>
          <option value='vi'>Ti·∫øng Vi·ªát</option>
        </select>
      </div>

      {/* Font Size */}
      <div style={{ marginBottom: '15px' }}>
        <label>{t('fontSize')}: </label>
        <select
          value={fontSize}
          onChange={(e) => setFontSize(e.target.value)}
        >
          <option value='small'>Small</option>
          <option value='medium'>Medium</option>
          <option value='large'>Large</option>
        </select>
      </div>

      {/* Notifications */}
      <div style={{ marginBottom: '15px' }}>
        <label>
          <input
            type='checkbox'
            checked={notificationsEnabled}
            onChange={toggleNotifications}
          />{' '}
          {t('notifications')}
        </label>
      </div>
    </div>
  );
}

function PreviewPanel() {
  const { theme } = useTheme();
  const { t } = useLanguage();
  const { fontSizeValue, notificationsEnabled } = usePreferences();

  return (
    <div
      style={{
        padding: '20px',
        marginTop: '20px',
        background: theme === 'light' ? '#fff' : '#222',
        color: theme === 'light' ? '#000' : '#fff',
        borderRadius: '8px',
        border: '1px solid ' + (theme === 'light' ? '#ddd' : '#555'),
      }}
    >
      <h2>{t('preview')}</h2>

      <p style={{ fontSize: fontSizeValue }}>{t('sampleText')}</p>

      <div style={{ marginTop: '15px', fontSize: fontSizeValue }}>
        <strong>Current Settings:</strong>
        <ul>
          <li>Theme: {theme}</li>
          <li>Font Size: {fontSizeValue}</li>
          <li>
            Notifications: {notificationsEnabled ? 'Enabled' : 'Disabled'}
          </li>
        </ul>
      </div>
    </div>
  );
}

function App() {
  return (
    <AppProviders>
      <div style={{ maxWidth: '600px', margin: '20px auto' }}>
        <h1 style={{ textAlign: 'center' }}>Settings Manager</h1>
        <SettingsPanel />
        <PreviewPanel />
      </div>
    </AppProviders>
  );
}

/**
 * TESTING CHECKLIST:
 * ‚úÖ Toggle theme ‚Üí Background v√† text color thay ƒë·ªïi
 * ‚úÖ Change language ‚Üí Text labels thay ƒë·ªïi
 * ‚úÖ Change fontSize ‚Üí Preview text size thay ƒë·ªïi
 * ‚úÖ Toggle notifications ‚Üí Checkbox state thay ƒë·ªïi
 * ‚úÖ Multiple contexts ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p
 * ‚úÖ Kh√¥ng c√≥ conflict gi·ªØa c√°c contexts
 *
 * PERFORMANCE NOTE:
 * - Khi toggle theme, ch·ªâ components d√πng useTheme re-render
 * - Khi change language, ch·ªâ components d√πng useLanguage re-render
 * - Optimization h∆°n n·ªØa s·∫Ω h·ªçc ·ªü Ng√†y 38
 */
```

</details>

### ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Level 5: Feature Flags System (90 ph√∫t)

```jsx
/**
 * üéØ M·ª•c ti√™u: Production-ready Context pattern
 * ‚è±Ô∏è Th·ªùi gian: 90 ph√∫t
 *
 * üìã Feature Specification:
 * Feature Flags System cho ph√©p enable/disable features trong app
 * Use case: A/B testing, gradual rollout, kill switch
 *
 * üèóÔ∏è Technical Design Doc:
 *
 * 1. Component Architecture:
 *    - FeatureFlagsContext: Store flags state
 *    - FeatureFlagsProvider: Load flags from localStorage
 *    - useFeatureFlag(flagName): Check if enabled
 *    - FeatureGate: Wrapper component ƒë·ªÉ conditionally render
 *    - AdminPanel: UI ƒë·ªÉ toggle flags
 *
 * 2. State Management Strategy:
 *    - Initial flags from localStorage (persistence)
 *    - Update flags ‚Üí save to localStorage
 *    - Default flags n·∫øu localStorage empty
 *
 * 3. API Integration Points:
 *    - (Future) Fetch flags from server
 *    - (Future) Real-time flag updates
 *
 * 4. Performance Considerations:
 *    - Memoize context value
 *    - Avoid unnecessary re-renders
 *
 * 5. Error Handling Strategy:
 *    - Invalid flag name ‚Üí return false
 *    - localStorage error ‚Üí use default flags
 *
 * ‚úÖ Production Checklist:
 * - [ ] Persistence v·ªõi localStorage
 * - [ ] Default flags configuration
 * - [ ] FeatureGate component
 * - [ ] useFeatureFlag hook
 * - [ ] Admin panel UI
 * - [ ] Error handling
 * - [ ] Documentation
 *
 * üìù Documentation:
 * - README.md v·ªõi usage examples
 * - Component API documentation
 */
```

<details>
<summary>üí° Solution</summary>

````jsx
import { createContext, useContext, useState, useEffect, useMemo } from 'react';

/**
 * FEATURE FLAGS SYSTEM
 *
 * Production-ready feature toggle system v·ªõi:
 * - Persistence (localStorage)
 * - Type-safe flags
 * - Admin UI
 * - Error handling
 *
 * USAGE:
 * ```jsx
 * // Check flag
 * const showNewUI = useFeatureFlag('newUI');
 *
 * // Conditional render
 * <FeatureGate flag="newUI">
 *   <NewUIComponent />
 * </FeatureGate>
 * ```
 */

// 1. Default flags configuration
const DEFAULT_FLAGS = {
  newUI: false,
  darkMode: true,
  analytics: false,
  betaFeatures: false,
  advancedSearch: false,
};

const STORAGE_KEY = 'feature_flags';

// 2. Context
const FeatureFlagsContext = createContext();

function FeatureFlagsProvider({ children }) {
  // Load t·ª´ localStorage ho·∫∑c d√πng defaults
  const [flags, setFlags] = useState(() => {
    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      return stored ? JSON.parse(stored) : DEFAULT_FLAGS;
    } catch (error) {
      console.error('Failed to load feature flags:', error);
      return DEFAULT_FLAGS;
    }
  });

  // Save to localStorage khi flags thay ƒë·ªïi
  useEffect(() => {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(flags));
    } catch (error) {
      console.error('Failed to save feature flags:', error);
    }
  }, [flags]);

  // Toggle individual flag
  const toggleFlag = (flagName) => {
    if (!(flagName in flags)) {
      console.warn(`Unknown feature flag: ${flagName}`);
      return;
    }

    setFlags((prev) => ({
      ...prev,
      [flagName]: !prev[flagName],
    }));
  };

  // Enable flag
  const enableFlag = (flagName) => {
    if (!(flagName in flags)) {
      console.warn(`Unknown feature flag: ${flagName}`);
      return;
    }

    setFlags((prev) => ({
      ...prev,
      [flagName]: true,
    }));
  };

  // Disable flag
  const disableFlag = (flagName) => {
    if (!(flagName in flags)) {
      console.warn(`Unknown feature flag: ${flagName}`);
      return;
    }

    setFlags((prev) => ({
      ...prev,
      [flagName]: false,
    }));
  };

  // Reset to defaults
  const resetFlags = () => {
    setFlags(DEFAULT_FLAGS);
  };

  // Memoize value ƒë·ªÉ avoid unnecessary re-renders
  const value = useMemo(
    () => ({
      flags,
      toggleFlag,
      enableFlag,
      disableFlag,
      resetFlags,
    }),
    [flags],
  );

  return (
    <FeatureFlagsContext.Provider value={value}>
      {children}
    </FeatureFlagsContext.Provider>
  );
}

// 3. Custom Hooks
function useFeatureFlags() {
  const context = useContext(FeatureFlagsContext);

  if (!context) {
    throw new Error('useFeatureFlags must be used within FeatureFlagsProvider');
  }

  return context;
}

function useFeatureFlag(flagName) {
  const { flags } = useFeatureFlags();

  if (!(flagName in flags)) {
    console.warn(`Unknown feature flag: ${flagName}`);
    return false;
  }

  return flags[flagName];
}

// 4. FeatureGate Component
function FeatureGate({ flag, fallback = null, children }) {
  const isEnabled = useFeatureFlag(flag);

  if (!isEnabled) {
    return fallback;
  }

  return children;
}

// 5. Admin Panel
function AdminPanel() {
  const { flags, toggleFlag, resetFlags } = useFeatureFlags();

  return (
    <div
      style={{
        border: '2px solid #333',
        borderRadius: '8px',
        padding: '20px',
        marginBottom: '20px',
        background: '#f9f9f9',
      }}
    >
      <h2>üö© Feature Flags Admin</h2>

      <div style={{ marginBottom: '15px' }}>
        {Object.entries(flags).map(([flagName, isEnabled]) => (
          <div
            key={flagName}
            style={{
              marginBottom: '10px',
              padding: '10px',
              background: '#fff',
              borderRadius: '4px',
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
            }}
          >
            <div>
              <strong>{flagName}</strong>
              <span
                style={{
                  marginLeft: '10px',
                  color: isEnabled ? 'green' : 'red',
                  fontWeight: 'bold',
                }}
              >
                {isEnabled ? '‚úÖ Enabled' : '‚ùå Disabled'}
              </span>
            </div>

            <button
              onClick={() => toggleFlag(flagName)}
              style={{
                padding: '5px 15px',
                cursor: 'pointer',
                background: isEnabled ? '#f44336' : '#4CAF50',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
              }}
            >
              {isEnabled ? 'Disable' : 'Enable'}
            </button>
          </div>
        ))}
      </div>

      <button
        onClick={resetFlags}
        style={{
          padding: '10px 20px',
          background: '#ff9800',
          color: 'white',
          border: 'none',
          borderRadius: '4px',
          cursor: 'pointer',
        }}
      >
        Reset to Defaults
      </button>
    </div>
  );
}

// 6. Demo Components
function NewUI() {
  return (
    <div
      style={{
        padding: '20px',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        color: 'white',
        borderRadius: '8px',
        marginBottom: '15px',
      }}
    >
      <h3>üé® New UI Design</h3>
      <p>This is the redesigned interface with modern aesthetics.</p>
    </div>
  );
}

function OldUI() {
  return (
    <div
      style={{
        padding: '20px',
        background: '#e0e0e0',
        borderRadius: '8px',
        marginBottom: '15px',
      }}
    >
      <h3>Legacy UI</h3>
      <p>This is the classic interface.</p>
    </div>
  );
}

function AdvancedSearch() {
  return (
    <div
      style={{
        padding: '15px',
        border: '2px dashed #2196F3',
        borderRadius: '8px',
        marginBottom: '15px',
      }}
    >
      <h4>üîç Advanced Search</h4>
      <input
        type='text'
        placeholder='Search with filters...'
        style={{ width: '100%', padding: '8px' }}
      />
      <div style={{ marginTop: '10px' }}>
        <label>
          <input type='checkbox' /> Include archived
        </label>
        <label style={{ marginLeft: '15px' }}>
          <input type='checkbox' /> Exact match
        </label>
      </div>
    </div>
  );
}

function BasicSearch() {
  return (
    <div style={{ marginBottom: '15px' }}>
      <input
        type='text'
        placeholder='Basic search...'
        style={{ width: '100%', padding: '8px' }}
      />
    </div>
  );
}

function Analytics() {
  return (
    <div
      style={{
        padding: '15px',
        background: '#fff3cd',
        border: '1px solid #ffc107',
        borderRadius: '8px',
        marginBottom: '15px',
      }}
    >
      <h4>üìä Analytics Tracking</h4>
      <p>User analytics and tracking enabled.</p>
    </div>
  );
}

function BetaFeatures() {
  return (
    <div
      style={{
        padding: '15px',
        background: '#d1ecf1',
        border: '1px solid #0c5460',
        borderRadius: '8px',
        marginBottom: '15px',
      }}
    >
      <h4>üß™ Beta Features</h4>
      <ul>
        <li>AI-powered suggestions</li>
        <li>Real-time collaboration</li>
        <li>Advanced reporting</li>
      </ul>
    </div>
  );
}

// 7. Main App
function App() {
  return (
    <FeatureFlagsProvider>
      <div style={{ maxWidth: '800px', margin: '20px auto', padding: '20px' }}>
        <h1 style={{ textAlign: 'center' }}>Feature Flags Demo</h1>

        {/* Admin Panel */}
        <AdminPanel />

        {/* Feature-gated UI */}
        <div>
          <h2>Application Features</h2>

          {/* New UI vs Old UI */}
          <FeatureGate
            flag='newUI'
            fallback={<OldUI />}
          >
            <NewUI />
          </FeatureGate>

          {/* Advanced Search vs Basic Search */}
          <FeatureGate
            flag='advancedSearch'
            fallback={<BasicSearch />}
          >
            <AdvancedSearch />
          </FeatureGate>

          {/* Optional Analytics */}
          <FeatureGate flag='analytics'>
            <Analytics />
          </FeatureGate>

          {/* Optional Beta Features */}
          <FeatureGate flag='betaFeatures'>
            <BetaFeatures />
          </FeatureGate>
        </div>
      </div>
    </FeatureFlagsProvider>
  );
}

/**
 * DOCUMENTATION:
 *
 * ## Installation
 * Wrap app with FeatureFlagsProvider
 *
 * ## Usage
 *
 * ### Check flag in component
 * ```jsx
 * const showNewFeature = useFeatureFlag('newFeature');
 * if (showNewFeature) {
 *   return <NewFeature />;
 * }
 * ```
 *
 * ### Conditional rendering
 * ```jsx
 * <FeatureGate flag="newFeature" fallback={<OldFeature />}>
 *   <NewFeature />
 * </FeatureGate>
 * ```
 *
 * ### Programmatic control
 * ```jsx
 * const { enableFlag, disableFlag } = useFeatureFlags();
 * enableFlag('newFeature');
 * ```
 *
 * ## Error Handling
 * - Unknown flags return false + warning
 * - localStorage errors fallback to defaults
 *
 * ## Performance
 * - Context value is memoized
 * - Only re-renders when flags change
 * - Persist to localStorage automatically
 */
````

</details>

---

## üìä PH·∫¶N 4: SO S√ÅNH PATTERNS (30 ph√∫t)

### B·∫£ng So S√°nh: Props vs Context

| Ti√™u ch√≠        | Props Drilling                | Context API                              |
| --------------- | ----------------------------- | ---------------------------------------- |
| **Use Case**    | Data qua 1-2 level            | Data qua nhi·ªÅu levels (3+)               |
| **Explicit**    | ‚úÖ R√µ r√†ng data flow          | ‚ùå ·∫®n, kh√≥ trace                         |
| **Reusability** | ‚úÖ Component ƒë·ªôc l·∫≠p          | ‚ö†Ô∏è Ph·ª• thu·ªôc Provider                    |
| **Performance** | ‚úÖ Optimal                    | ‚ö†Ô∏è Re-render issues (n·∫øu kh√¥ng optimize) |
| **Refactoring** | ‚ùå Kh√≥ (ph·∫£i s·ª≠a nhi·ªÅu files) | ‚úÖ D·ªÖ (ch·ªâ s·ª≠a Provider)                 |
| **Testing**     | ‚úÖ D·ªÖ test (pass props)       | ‚ö†Ô∏è C·∫ßn mock Provider                     |
| **Debugging**   | ‚úÖ D·ªÖ debug                   | ‚ö†Ô∏è Kh√≥ trace source                      |
| **Best For**    | Component composition         | Global/cross-cutting concerns            |

### B·∫£ng So S√°nh: Context vs External State (Preview)

| Ti√™u ch√≠           | Context API            | Redux/Zustand (ch∆∞a h·ªçc)   |
| ------------------ | ---------------------- | -------------------------- |
| **Learning Curve** | ‚úÖ ƒê∆°n gi·∫£n            | ‚ö†Ô∏è Ph·ª©c t·∫°p                |
| **Boilerplate**    | ‚úÖ √çt code             | ‚ùå Nhi·ªÅu code              |
| **DevTools**       | ‚ùå Kh√¥ng c√≥            | ‚úÖ Redux DevTools          |
| **Performance**    | ‚ö†Ô∏è Manual optimization | ‚úÖ Auto-optimized          |
| **When to use**    | Simple state sharing   | Complex state, time-travel |

### Decision Tree

```
C·∫¶N SHARE STATE?
‚îú‚îÄ NO ‚Üí D√πng props ho·∫∑c local state
‚îî‚îÄ YES ‚Üí Data qua bao nhi√™u levels?
    ‚îú‚îÄ 1-2 levels ‚Üí Props drilling (OK)
    ‚îî‚îÄ 3+ levels ‚Üí C√≥ ph·∫£i global concern?
        ‚îú‚îÄ YES (theme, auth, language) ‚Üí Context
        ‚îî‚îÄ NO (business logic) ‚Üí Xem x√©t Redux (h·ªçc sau)

DATA THAY ƒê·ªîI TH∆Ø·ªúNG XUY√äN?
‚îú‚îÄ √çt (theme, config) ‚Üí Context OK
‚îî‚îÄ Nhi·ªÅu (real-time data) ‚Üí Xem x√©t external state

S·ªê CONSUMERS?
‚îú‚îÄ √çt (2-3 components) ‚Üí Props ho·∫∑c Context
‚îî‚îÄ Nhi·ªÅu (10+ components) ‚Üí Context + Optimization (Ng√†y 38)
```

---

## üß™ PH·∫¶N 5: DEBUG LAB (20 ph√∫t)

### Bug 1: useContext Outside Provider ‚ö†Ô∏è

```jsx
/**
 * üêõ BUG: Component crash v·ªõi error
 * "Cannot read property 'theme' of undefined"
 *
 * üéØ CHALLENGE: T√¨m l·ªói v√† fix
 */

const ThemeContext = createContext();

function ThemeToggle() {
  const { theme, setTheme } = useContext(ThemeContext); // ‚ùå Error!

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      Toggle
    </button>
  );
}

function App() {
  return <ThemeToggle />; // ‚ùå Kh√¥ng c√≥ Provider!
}

// ‚ùì QUESTIONS:
// 1. T·∫°i sao l·ªói?
// 2. L√†m sao fix?
// 3. L√†m sao prevent l·ªói n√†y?
```

**üí° Gi·∫£i th√≠ch:**

```jsx
// NGUY√äN NH√ÇN:
// - useContext(ThemeContext) tr·∫£ v·ªÅ undefined
// - V√¨ kh√¥ng c√≥ Provider wrap component
// - Destructuring undefined ‚Üí crash

// ‚úÖ FIX 1: Wrap v·ªõi Provider
function App() {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <ThemeToggle />
    </ThemeContext.Provider>
  );
}

// ‚úÖ FIX 2: Custom hook v·ªõi error check
function useTheme() {
  const context = useContext(ThemeContext);

  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }

  return context;
}

// PREVENTION:
// - LU√îN t·∫°o custom hook v·ªõi error check
// - Setup ESLint rule ƒë·ªÉ detect missing Provider
```

### Bug 2: Stale Value trong Context ‚ö†Ô∏è

```jsx
/**
 * üêõ BUG: Callback trong Context lu√¥n d√πng gi√° tr·ªã c≈©
 *
 * üéØ CHALLENGE: T√¨m l·ªói v√† fix
 */

function CounterProvider({ children }) {
  const [count, setCount] = useState(0);

  // ‚ùå Function n√†y t·∫°o closure v·ªõi count ban ƒë·∫ßu (0)
  const increment = () => {
    setCount(count + 1); // count lu√¥n l√† 0!
  };

  const value = { count, increment };

  return (
    <CounterContext.Provider value={value}>{children}</CounterContext.Provider>
  );
}

function Counter() {
  const { count, increment } = useContext(CounterContext);

  return (
    <div>
      <p>{count}</p>
      <button onClick={increment}>+1</button>
      {/* Click nhi·ªÅu l·∫ßn nh∆∞ng count ch·ªâ l√™n 1! */}
    </div>
  );
}

// ‚ùì QUESTIONS:
// 1. T·∫°i sao count ch·ªâ l√™n 1?
// 2. Stale closure l√† g√¨?
// 3. L√†m sao fix?
```

**üí° Gi·∫£i th√≠ch:**

```jsx
// NGUY√äN NH√ÇN:
// - increment function t·∫°o closure v·ªõi count = 0
// - M·ªói l·∫ßn Provider re-render, function m·ªõi ƒë∆∞·ª£c t·∫°o
// - Nh∆∞ng function v·∫´n reference count c≈©

// ‚úÖ FIX: D√πng functional update
function CounterProvider({ children }) {
  const [count, setCount] = useState(0);

  // Functional update kh√¥ng ph·ª• thu·ªôc v√†o count hi·ªán t·∫°i
  const increment = () => {
    setCount((prev) => prev + 1); // ‚úÖ Lu√¥n ƒë√∫ng!
  };

  const value = { count, increment };

  return (
    <CounterContext.Provider value={value}>{children}</CounterContext.Provider>
  );
}

// L∆ØU √ù:
// - LU√îN d√πng functional update trong callbacks
// - ƒê·∫∑c bi·ªát khi callback ƒë∆∞·ª£c memoize (useCallback - Ng√†y 34)
```

### Bug 3: Context Value Object Recreation ‚ö†Ô∏è

```jsx
/**
 * üêõ BUG: Component re-render kh√¥ng c·∫ßn thi·∫øt
 *
 * üéØ CHALLENGE: T√¨m performance issue
 */

function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  // ‚ùå M·ªói render t·∫°o object m·ªõi!
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

function ExpensiveComponent() {
  const { theme } = useContext(ThemeContext);

  console.log('ExpensiveComponent rendered!');
  // Component n√†y render M·ªñI KHI ThemeProvider render
  // D√π theme kh√¥ng ƒë·ªïi!

  return <div>Theme: {theme}</div>;
}

// ‚ùì QUESTIONS:
// 1. T·∫°i sao ExpensiveComponent re-render nhi·ªÅu?
// 2. Object identity l√† g√¨?
// 3. L√†m sao optimize?
```

**üí° Gi·∫£i th√≠ch:**

```jsx
// NGUY√äN NH√ÇN:
// - { theme, setTheme } t·∫°o object M·ªöI m·ªói render
// - Context so s√°nh value b·∫±ng reference (===)
// - Object m·ªõi ‚Üí Context thay ƒë·ªïi ‚Üí consumers re-render

// ‚úÖ FIX: S·∫Ω h·ªçc ·ªü Ng√†y 38 (useMemo)
// (T·∫°m th·ªùi ch·∫•p nh·∫≠n bug n√†y, kh√¥ng optimize s·ªõm)

// PREVIEW (Ng√†y 38):
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  // Memoize value object
  const value = useMemo(() => ({ theme, setTheme }), [theme]);

  return (
    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
  );
}

// L∆ØU √ù:
// - KH√îNG optimize s·ªõm!
// - Ch·ªâ optimize khi c√≥ performance issue th·∫≠t
// - Measure first, optimize later
```

---

## ‚úÖ PH·∫¶N 6: T·ª∞ ƒê√ÅNH GI√Å (15 ph√∫t)

### Knowledge Check

- [ ] T√¥i hi·ªÉu Props Drilling l√† g√¨ v√† t·∫°i sao n√≥ l√† v·∫•n ƒë·ªÅ
- [ ] T√¥i bi·∫øt c√°ch t·∫°o Context v·ªõi createContext()
- [ ] T√¥i bi·∫øt c√°ch cung c·∫•p value qua Provider
- [ ] T√¥i bi·∫øt c√°ch consume value v·ªõi useContext()
- [ ] T√¥i bi·∫øt khi n√†o N√äN d√πng Context
- [ ] T√¥i bi·∫øt khi n√†o KH√îNG N√äN d√πng Context (props ƒë∆°n gi·∫£n h∆°n)
- [ ] T√¥i bi·∫øt c√°ch t·∫°o custom hook cho Context
- [ ] T√¥i bi·∫øt c√°ch handle missing Provider
- [ ] T√¥i hi·ªÉu stale closure trong Context callbacks
- [ ] T√¥i bi·∫øt Context value object recreation issue (ch∆∞a fix, ch·ªâ bi·∫øt)

### Code Review Checklist

**Context Setup:**

- [ ] Context t·∫°o NGO√ÄI component (kh√¥ng t·∫°o l·∫°i m·ªói render)
- [ ] Provider c√≥ default value (fallback)
- [ ] Custom hook c√≥ error check cho missing Provider

**Value Object:**

- [ ] Value object ch·ª©a c·∫£ state v√† functions
- [ ] Functions d√πng functional updates (tr√°nh stale closure)
- [ ] (Ch∆∞a optimize) Bi·∫øt r·∫±ng object t·∫°o m·ªõi m·ªói render

**Usage:**

- [ ] Ch·ªâ d√πng Context khi data qua 3+ levels
- [ ] Props drilling cho 1-2 levels
- [ ] Context cho global concerns (theme, auth, language)
- [ ] KH√îNG d√πng Context cho business logic (ch∆∞a ph·ª©c t·∫°p)

**Error Handling:**

- [ ] Custom hook throw error n·∫øu outside Provider
- [ ] Default value cho Context (fallback)

---

## üè† B√ÄI T·∫¨P V·ªÄ NH√Ä

### B·∫Øt bu·ªôc (30 ph√∫t)

**Notification System v·ªõi Context**

T·∫°o NotificationContext ƒë·ªÉ qu·∫£n l√Ω toast notifications:

Requirements:

- addNotification(message, type) - type: 'success', 'error', 'info'
- removeNotification(id)
- Notifications t·ª± ƒë·ªông bi·∫øn m·∫•t sau 3 gi√¢y
- T·ªëi ƒëa 3 notifications c√πng l√∫c
- Position: top-right c·ªßa m√†n h√¨nh

G·ª£i √Ω:

```jsx
const notification = {
  id: Date.now(),
  message: 'Success!',
  type: 'success',
};
```

### N√¢ng cao (60 ph√∫t)

**Modal Manager v·ªõi Context**

T·∫°o ModalContext ƒë·ªÉ qu·∫£n l√Ω modals:

Requirements:

- openModal(component, props)
- closeModal()
- Ch·ªâ 1 modal active t·∫°i 1 th·ªùi ƒëi·ªÉm
- Click overlay ƒë·ªÉ ƒë√≥ng
- ESC key ƒë·ªÉ ƒë√≥ng
- Prevent body scroll khi modal m·ªü

Extra:

- Multiple modals stack (array)
- Modal history (back/forward)

---

## üìö T√ÄI LI·ªÜU THAM KH·∫¢O

### B·∫Øt bu·ªôc ƒë·ªçc

1. **React Docs - Context:**
   https://react.dev/learn/passing-data-deeply-with-context

2. **Kent C. Dodds - How to use React Context effectively:**
   https://kentcdodds.com/blog/how-to-use-react-context-effectively

### ƒê·ªçc th√™m

1. **React Docs - useContext:**
   https://react.dev/reference/react/useContext

2. **When (and when not) to use Context:**
   https://blog.logrocket.com/react-context-api-deep-dive-examples/

---

## üîó K·∫æT N·ªêI KI·∫æN TH·ª®C

### Ki·∫øn th·ª©c n·ªÅn (c·∫ßn bi·∫øt)

- **Ng√†y 11-12:** useState patterns (Context d√πng state internally)
- **Ng√†y 21-22:** useRef (ƒë·ªÉ so s√°nh v·ªõi Context use cases)
- **Ng√†y 24:** Custom hooks (Context th∆∞·ªùng wrap trong custom hooks)

### H∆∞·ªõng t·ªõi (s·∫Ω d√πng)

- **Ng√†y 37:** Context + useReducer (powerful combo!)
- **Ng√†y 38:** Context performance optimization (useMemo)
- **Ng√†y 41-43:** Form context v·ªõi React Hook Form

---

## üí° SENIOR INSIGHTS

### C√¢n Nh·∫Øc Production

**Context KH√îNG ph·∫£i State Management:**

```jsx
// ‚ùå Anti-pattern: D√πng Context nh∆∞ Redux
const AppContext = createContext();

function AppProvider({ children }) {
  const [users, setUsers] = useState([]);
  const [posts, setPosts] = useState([]);
  const [comments, setComments] = useState([]);
  // ... 20 states n·ªØa

  // ‚ùå Qu√° nhi·ªÅu responsibility!
}

// ‚úÖ Better: T√°ch th√†nh nhi·ªÅu contexts
<UserProvider>
  <PostProvider>
    <CommentProvider>
      <App />
    </CommentProvider>
  </PostProvider>
</UserProvider>;
```

**Context cho Configuration, kh√¥ng ph·∫£i Cache:**

```jsx
// ‚úÖ GOOD: Theme, language (√≠t thay ƒë·ªïi)
<ThemeProvider>
<LanguageProvider>

// ‚ùå BAD: API data (thay ƒë·ªïi li√™n t·ª•c)
<APIDataProvider>
// ‚Üí D√πng React Query (h·ªçc sau)
```

**Multiple Providers Pattern:**

```jsx
// ‚úÖ Composition pattern
function AppProviders({ children }) {
  return (
    <ThemeProvider>
      <LanguageProvider>
        <AuthProvider>
          <NotificationProvider>{children}</NotificationProvider>
        </AuthProvider>
      </LanguageProvider>
    </ThemeProvider>
  );
}
```

### C√¢u H·ªèi Ph·ªèng V·∫•n

**Junior:**

1. Context API l√† g√¨? Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ g√¨?
2. Props drilling l√† g√¨? T·∫°i sao l√† v·∫•n ƒë·ªÅ?
3. useContext hook d√πng nh∆∞ th·∫ø n√†o?

**Mid:**

1. So s√°nh Props drilling vs Context. Khi n√†o d√πng c√°i n√†o?
2. L√†m sao handle missing Provider?
3. T·∫°i sao n√™n t·∫°o custom hook cho Context?

**Senior:**

1. Context c√≥ performance issues g√¨? L√†m sao optimize?
2. So s√°nh Context API vs Redux/Zustand
3. Khi n√†o KH√îNG n√™n d√πng Context?
4. Multiple contexts vs single context - trade-offs?

### War Stories

**Story 1: The Context Overuse**

```
Team d√πng Context cho M·ªåI TH·ª®:
- User data ‚Üí Context
- API responses ‚Üí Context
- Form state ‚Üí Context
- UI state ‚Üí Context

K·∫øt qu·∫£:
- Re-render nightmare
- Kh√≥ debug
- Performance t·ªá

Fix:
- Ch·ªâ d√πng Context cho global concerns
- Local state cho local data
- React Query cho server state
```

**Story 2: Missing Provider Hell**

```
Component crash production:
"Cannot read property 'user' of undefined"

Nguy√™n nh√¢n:
- useContext(AuthContext) nh∆∞ng thi·∫øu Provider
- Kh√¥ng c√≥ error boundary
- Kh√¥ng c√≥ default value

Fix:
- Custom hook v·ªõi error check
- Default value cho Context
- Error boundaries wrap app
```

---

## üéØ PREVIEW NG√ÄY 37

**Context + useReducer - The Power Combo**

Ng√†y mai ch√∫ng ta s·∫Ω h·ªçc:

- K·∫øt h·ª£p Context v·ªõi useReducer
- Patterns cho complex state
- Dispatch actions qua Context
- State machine v·ªõi Context

Teaser:

```jsx
// Context + useReducer = üî•
const [state, dispatch] = useReducer(reducer, initialState);

<AppContext.Provider value={{ state, dispatch }}>
  {/* M·ªçi component c√≥ th·ªÉ dispatch actions! */}
</AppContext.Provider>;
```

**Chu·∫©n b·ªã:**

- Review useReducer (Ng√†y 26-29)
- Hi·ªÉu Context patterns (Ng√†y 36)
- Suy nghƒ©: L√†m sao k·∫øt h·ª£p 2 concepts n√†y?

---

‚úÖ **Ho√†n th√†nh Ng√†y 36!**

B·∫°n ƒë√£ bi·∫øt:

- Props Drilling v√† Context API
- createContext, Provider, useContext
- Custom hooks cho Context
- Common pitfalls v√† c√°ch tr√°nh

Ti·∫øp theo: Context + useReducer cho complex state management! üöÄ
