# ğŸ“… NGÃ€Y 16: useEffect - Introduction

## ğŸ“ Phase 2, Tuáº§n 4, NgÃ y 16 cá»§a 45

## â±ï¸ Thá»i lÆ°á»£ng: 3-4 giá»

---

## ğŸ¯ Má»¥c tiÃªu há»c táº­p (5 phÃºt)

- [ ] Hiá»ƒu Ä‘Æ°á»£c khÃ¡i niá»‡m **Side Effects** trong React vÃ  táº¡i sao chÃºng ta cáº§n quáº£n lÃ½ chÃºng
- [ ] Sá»­ dá»¥ng Ä‘Æ°á»£c `useEffect` hook vá»›i cÃº phÃ¡p cÆ¡ báº£n
- [ ] PhÃ¢n biá»‡t Ä‘Æ°á»£c khi nÃ o effect cháº¡y vá»›i `[]` (empty deps) vÃ  khÃ´ng cÃ³ deps
- [ ] Ãp dá»¥ng Ä‘Æ°á»£c `useEffect` cho cÃ¡c trÆ°á»ng há»£p thá»±c táº¿: document.title, console.log, timers

---

## ğŸ¤” Kiá»ƒm tra Ä‘áº§u vÃ o (5 phÃºt)

TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y tráº£ lá»i 3 cÃ¢u há»i sau Ä‘á»ƒ kÃ­ch hoáº¡t kiáº¿n thá»©c ná»n:

1. **CÃ¢u 1:** Khi báº¡n gá»i `setCount(count + 1)`, Ä‘iá»u gÃ¬ xáº£y ra vá»›i component?
   - _ÄÃ¡p Ã¡n mong Ä‘á»£i: Component re-render_

2. **CÃ¢u 2:** Náº¿u báº¡n muá»‘n cháº¡y má»™t Ä‘oáº¡n code SAU KHI component Ä‘Ã£ hiá»ƒn thá»‹ lÃªn mÃ n hÃ¬nh, báº¡n Ä‘áº·t nÃ³ á»Ÿ Ä‘Ã¢u?
   - _ÄÃ¡p Ã¡n: Hiá»‡n táº¡i chÆ°a biáº¿t cÃ¡ch! (ÄÃ¢y lÃ  lÃ½ do cáº§n useEffect)_

3. **CÃ¢u 3:** `useState` giÃºp component "nhá»›" data giá»¯a cÃ¡c láº§n render. Váº­y náº¿u báº¡n muá»‘n "lÃ m gÃ¬ Ä‘Ã³" má»—i khi component render thÃ¬ sao?
   - _ÄÃ¡p Ã¡n: CÅ©ng chÆ°a biáº¿t! (useEffect sáº½ giáº£i quyáº¿t)_

---

## ğŸ“– PHáº¦N 1: GIá»šI THIá»†U KHÃI NIá»†M (30 phÃºt)

### 1.1 Váº¥n Äá» Thá»±c Táº¿

HÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n Ä‘ang xÃ¢y dá»±ng má»™t **Counter App** Ä‘Æ¡n giáº£n:

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  // âŒ PROBLEM: Báº¡n muá»‘n update document title má»—i khi count thay Ä‘á»•i
  // NhÆ°ng náº¿u lÃ m tháº¿ nÃ y:
  document.title = `Count: ${count}`;

  return (
    <div>
      <h1>{count}</h1>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

**Váº¥n Ä‘á» vá»›i code trÃªn:**

- Code `document.title = ...` cháº¡y TRONG quÃ¡ trÃ¬nh render
- Render function pháº£i PURE (khÃ´ng side effects)
- Náº¿u render bá»‹ gá»i nhiá»u láº§n (React 18 Strict Mode), title sáº½ update nhiá»u láº§n khÃ´ng cáº§n thiáº¿t
- KhÃ³ kiá»ƒm soÃ¡t TIMING (trÆ°á»›c hay sau khi UI xuáº¥t hiá»‡n?)

**Äá»‹nh nghÄ©a Side Effect:**

> Side Effect lÃ  Báº¤T Ká»² thao tÃ¡c nÃ o mÃ :
>
> 1. áº¢nh hÆ°á»Ÿng Ä‘áº¿n thá»© BÃŠN NGOÃ€I component
> 2. KHÃ”NG liÃªn quan trá»±c tiáº¿p Ä‘áº¿n viá»‡c render UI
> 3. Cáº§n cháº¡y á» Má»˜T THá»œI ÄIá»‚M Cá»¤ THá»‚ trong lifecycle

**VÃ­ dá»¥ Side Effects phá»• biáº¿n:**

- âœ… Fetch data tá»« API
- âœ… Update `document.title`
- âœ… Set timers (`setTimeout`, `setInterval`)
- âœ… Subscribe to events (scroll, resize)
- âœ… Manipulate DOM trá»±c tiáº¿p
- âœ… Log analytics
- âœ… Save to localStorage

---

### 1.2 Giáº£i PhÃ¡p: useEffect Hook

`useEffect` lÃ  hook giÃºp báº¡n **thá»±c hiá»‡n side effects AN TOÃ€N** trong function components.

**CÃº phÃ¡p cÆ¡ báº£n:**

```jsx
import { useEffect } from 'react';

function MyComponent() {
  useEffect(() => {
    // Code cá»§a báº¡n á»Ÿ Ä‘Ã¢y
    // Cháº¡y SAU KHI component render
  });

  return <div>UI cá»§a báº¡n</div>;
}
```

**GIáº¢I PHÃP cho Counter:**

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  // âœ… ÄÃšNG: DÃ¹ng useEffect
  useEffect(() => {
    document.title = `Count: ${count}`;
  });

  return (
    <div>
      <h1>{count}</h1>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

**Táº¡i sao cÃ¡ch nÃ y tá»‘t hÆ¡n?**

1. âœ… **Separation of Concerns:** Render logic â‰  Side effect logic
2. âœ… **Predictable Timing:** Effect cháº¡y SAU khi DOM Ä‘Ã£ update
3. âœ… **React-controlled:** React quyáº¿t Ä‘á»‹nh KHI NÃ€O cháº¡y effect
4. âœ… **Cleanup support:** CÃ³ thá»ƒ dá»n dáº¹p (sáº½ há»c á»Ÿ NgÃ y 18)

---

### 1.3 Mental Model: The Effect Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENT LIFECYCLE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. React calls your component function
   â†“
2. Component returns JSX
   â†“
3. React updates the DOM
   â†“
4. Browser paints the screen
   â†“
5. useEffect runs â† EFFECT CHáº Y á» ÄÃ‚Y!
   â†“
6. User sees updated UI + Effect Ä‘Ã£ cháº¡y

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

QUAN TRá»ŒNG:
- Effect cháº¡y SAU khi user Ä‘Ã£ nhÃ¬n tháº¥y UI
- Effect KHÃ”NG block browser paint
- Effect lÃ  ASYNCHRONOUS vá»›i rendering
```

**Analogy dá»… hiá»ƒu:**

> React nhÆ° má»™t nhÃ  hÃ ng:
>
> 1. Báº¿p náº¥u mÃ³n Äƒn (Render JSX)
> 2. Phá»¥c vá»¥ Ä‘em ra bÃ n (Update DOM)
> 3. KhÃ¡ch Äƒn (User sees UI)
> 4. Phá»¥c vá»¥ quay láº¡i há»i "MÃ³n Äƒn cÃ³ ngon khÃ´ng?" (useEffect runs)
>
> useEffect lÃ  "háº­u sá»± vá»¥" - lÃ m sau khi mÃ³n chÃ­nh Ä‘Ã£ phá»¥c vá»¥ xong!

---

### 1.4 Hiá»ƒu Láº§m Phá»• Biáº¿n

#### âŒ Hiá»ƒu láº§m #1: "useEffect cháº¡y TRÆ¯á»šC khi render"

```jsx
function Wrong() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log('Effect'); // Cháº¡y SAU
  });

  console.log('Render'); // Cháº¡y TRÆ¯á»šC

  return <div>{count}</div>;
}

// Output:
// Render
// Effect  â† Cháº¡y sau!
```

#### âŒ Hiá»ƒu láº§m #2: "useEffect chá»‰ cháº¡y 1 láº§n"

```jsx
function Wrong() {
  const [count, setCount] = useState(0);

  // KhÃ´ng cÃ³ dependencies array â†’ Cháº¡y Má»–I láº§n render!
  useEffect(() => {
    console.log('Effect runs');
  });

  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}

// Má»—i láº§n click â†’ Re-render â†’ Effect cháº¡y láº¡i!
```

#### âŒ Hiá»ƒu láº§m #3: "useEffect vÃ  event handler giá»‘ng nhau"

```jsx
// âŒ SAI: DÃ¹ng useEffect cho user interaction
function Wrong() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    // Effect cháº¡y SAU render, khÃ´ng pháº£i khi user click!
    console.log('Clicked?'); // SAI!
  });

  return <button onClick={() => setCount(count + 1)}>Click me</button>;
}

// âœ… ÄÃšNG: DÃ¹ng event handler
function Correct() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount(count + 1);
    console.log('Clicked!'); // ÄÃšNG!
  };

  return <button onClick={handleClick}>Click me</button>;
}
```

**QUY Táº®C VÃ€NG:**

- ğŸ¯ **useEffect:** Cho side effects cáº§n cháº¡y SAU render (sync vá»›i state/props)
- ğŸ¯ **Event handlers:** Cho side effects tá»« USER ACTIONS (click, submit, etc.)

---

## ğŸ’» PHáº¦N 2: LIVE CODING (45 phÃºt)

### Demo 1: Pattern CÆ¡ Báº£n - Document Title â­

```jsx
/**
 * Demo: Update document title khi state thay Ä‘á»•i
 * Concepts: useEffect basic, no dependencies
 */

import { useState, useEffect } from 'react';

function DocumentTitleDemo() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('Guest');

  // Effect 1: Update title vá»›i count
  useEffect(() => {
    document.title = `Count: ${count}`;
    console.log('Effect 1 ran - Title updated');
  });

  // Effect 2: Log name changes
  useEffect(() => {
    console.log(`Effect 2 ran - Name is: ${name}`);
  });

  return (
    <div>
      <h2>Document Title Demo</h2>

      <div>
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>Increment</button>
      </div>

      <div>
        <input
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder='Enter your name'
        />
      </div>

      <p>
        ğŸ’¡ Má»Ÿ Console vÃ  thá»­: Click button HOáº¶C type vÃ o input
        <br />
        âš ï¸ Cáº£ 2 effects Ä‘á»u cháº¡y má»—i khi component re-render!
      </p>
    </div>
  );
}
```

**Quan sÃ¡t:**

1. Má»—i khi click button â†’ `count` thay Ä‘á»•i â†’ Component re-render â†’ Cáº¢ 2 effects cháº¡y
2. Má»—i khi nháº­p text â†’ `name` thay Ä‘á»•i â†’ Component re-render â†’ Cáº¢ 2 effects cháº¡y
3. âš ï¸ **Váº¤N Äá»€:** Effect 1 khÃ´ng cáº§n cháº¡y khi `name` thay Ä‘á»•i, vÃ  ngÆ°á»£c láº¡i!

**ğŸ’¡ Solution Preview:** NgÃ y 17 sáº½ há»c Dependencies Array Ä‘á»ƒ giáº£i quyáº¿t!

---

### Demo 2: Ká»‹ch Báº£n Thá»±c Táº¿ - Logger Component â­â­

```jsx
/**
 * Demo: Component log má»i thay Ä‘á»•i state
 * Use case: Debugging, Analytics tracking
 */

import { useState, useEffect } from 'react';

function UserProfileLogger() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    age: 0,
  });

  // Effect: Log má»—i khi user object thay Ä‘á»•i
  useEffect(() => {
    console.log('ğŸ“Š User Profile Updated:', {
      timestamp: new Date().toISOString(),
      data: user,
    });

    // Giáº£ láº­p gá»­i analytics
    // trackEvent('profile_updated', user);
  });

  const updateName = (e) => {
    setUser({ ...user, name: e.target.value });
  };

  const updateEmail = (e) => {
    setUser({ ...user, email: e.target.value });
  };

  const updateAge = (e) => {
    setUser({ ...user, age: parseInt(e.target.value) || 0 });
  };

  return (
    <div>
      <h2>User Profile Logger</h2>

      <div>
        <input
          type='text'
          placeholder='Name'
          value={user.name}
          onChange={updateName}
        />
      </div>

      <div>
        <input
          type='email'
          placeholder='Email'
          value={user.email}
          onChange={updateEmail}
        />
      </div>

      <div>
        <input
          type='number'
          placeholder='Age'
          value={user.age}
          onChange={updateAge}
        />
      </div>

      <div>
        <h3>Current Profile:</h3>
        <pre>{JSON.stringify(user, null, 2)}</pre>
      </div>

      <p>
        ğŸ’¡ Má»Ÿ Console: Má»—i láº§n nháº­p â†’ Effect log ra
        <br />
        ğŸ¯ Use case: Debugging state changes, Analytics
      </p>
    </div>
  );
}
```

**á»¨ng dá»¥ng thá»±c táº¿:**

- ğŸ“Š **Analytics:** Track user behavior
- ğŸ› **Debugging:** Log state changes Ä‘á»ƒ debug
- ğŸ’¾ **Auto-save:** Trigger save má»—i khi data thay Ä‘á»•i (sáº½ há»c cÃ¡ch optimize á»Ÿ NgÃ y 17)

---

### Demo 3: Edge Cases - Multiple Effects â­â­â­

```jsx
/**
 * Demo: Nhiá»u effects trong 1 component
 * Edge case: Effect order, effect interactions
 */

import { useState, useEffect } from 'react';

function MultipleEffectsDemo() {
  const [count, setCount] = useState(0);
  const [isEven, setIsEven] = useState(true);

  // Effect 1: Cháº¡y TRÆ¯á»šC
  useEffect(() => {
    console.log('1ï¸âƒ£ Effect 1: Count changed to', count);
  });

  // Effect 2: Cháº¡y SAU Effect 1
  useEffect(() => {
    console.log('2ï¸âƒ£ Effect 2: Checking if even...');
    setIsEven(count % 2 === 0);
  });

  // Effect 3: Cháº¡y SAU Effect 2
  useEffect(() => {
    console.log('3ï¸âƒ£ Effect 3: isEven is', isEven);
  });

  return (
    <div>
      <h2>Multiple Effects Demo</h2>

      <p>Count: {count}</p>
      <p>Is Even? {isEven ? 'Yes âœ…' : 'No âŒ'}</p>

      <button onClick={() => setCount(count + 1)}>Increment</button>

      <div>
        <h3>âš ï¸ QUAN TRá»ŒNG:</h3>
        <ul>
          <li>Effects cháº¡y theo THá»¨ Tá»° khai bÃ¡o (top to bottom)</li>
          <li>Effect 2 gá»i setIsEven â†’ Trigger RE-RENDER má»›i!</li>
          <li>Sau re-render má»›i â†’ Táº¥t cáº£ effects cháº¡y Láº I!</li>
        </ul>
      </div>
    </div>
  );
}
```

**Khi click button, console output:**

```
1ï¸âƒ£ Effect 1: Count changed to 1
2ï¸âƒ£ Effect 2: Checking if even...
3ï¸âƒ£ Effect 3: isEven is true
// â†’ setIsEven(false) trigger re-render â†’
1ï¸âƒ£ Effect 1: Count changed to 1
2ï¸âƒ£ Effect 2: Checking if even...
3ï¸âƒ£ Effect 3: isEven is false
```

**âš ï¸ LÆ¯U Ã:**

- Calling `setState` trong effect â†’ Trigger thÃªm render!
- CÃ³ thá»ƒ gÃ¢y **infinite loop** náº¿u khÃ´ng cáº©n tháº­n
- NgÃ y 17 sáº½ há»c cÃ¡ch control vá»›i Dependencies Array

---

## ğŸ”¨ PHáº¦N 3: BÃ€I Táº¬P THá»°C HÃ€NH (60 phÃºt)

### â­ Level 1: Ãp Dá»¥ng Concept (15 phÃºt)

```jsx
/**
 * ğŸ¯ Má»¥c tiÃªu: Sá»­ dá»¥ng useEffect Ä‘á»ƒ log component lifecycle
 * â±ï¸ Thá»i gian: 15 phÃºt
 * ğŸš« KHÃ”NG dÃ¹ng: Dependencies array (chÆ°a há»c), useRef, useLayoutEffect
 *
 * Requirements:
 * 1. Táº¡o component vá»›i 1 state counter
 * 2. DÃ¹ng useEffect Ä‘á»ƒ console.log "Component rendered" má»—i láº§n render
 * 3. Log ra giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a counter
 * 4. ThÃªm button Ä‘á»ƒ increment counter
 *
 * ğŸ’¡ Gá»£i Ã½: useEffect cháº¡y SAU má»—i render
 */

// âŒ CÃ¡ch SAI (Anti-pattern):
function WrongLifecycleLogger() {
  const [count, setCount] = useState(0);

  // SAI: Log trá»±c tiáº¿p trong render
  console.log('Component rendered'); // Cháº¡y TRONG render, khÃ´ng pháº£i SAU!

  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}

// Táº¡i sao sai?
// - Log cháº¡y TRONG quÃ¡ trÃ¬nh render
// - Náº¿u render bá»‹ gá»i nhiá»u láº§n (React Strict Mode), log spam
// - KhÃ´ng Ä‘Ãºng timing (cáº§n log SAU khi UI xuáº¥t hiá»‡n)

// âœ… CÃ¡ch ÄÃšNG (Best practice):
function CorrectLifecycleLogger() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log('âœ… Component rendered with count:', count);
    // Cháº¡y SAU khi DOM Ä‘Ã£ update
    // React kiá»ƒm soÃ¡t timing
  });

  return <button onClick={() => setCount(count + 1)}>Count: {count}</button>;
}

// Táº¡i sao tá»‘t hÆ¡n?
// âœ… Effect cháº¡y SAU render â†’ ÄÃºng timing
// âœ… React kiá»ƒm soÃ¡t â†’ Predictable
// âœ… TÃ¡ch biá»‡t render logic vÃ  side effect logic

// ğŸ¯ NHIá»†M Vá»¤ Cá»¦A Báº N:
function LifecycleLogger() {
  // TODO: Khai bÃ¡o state counter vá»›i giÃ¡ trá»‹ ban Ä‘áº§u 0

  // TODO: DÃ¹ng useEffect Ä‘á»ƒ log "Component rendered" + giÃ¡ trá»‹ counter

  return (
    <div>
      <h2>Lifecycle Logger</h2>
      {/* TODO: Hiá»ƒn thá»‹ counter */}
      {/* TODO: Button Ä‘á»ƒ increment */}
      <p>ğŸ’¡ Má»Ÿ Console Ä‘á»ƒ xem log</p>
    </div>
  );
}

// âœ… Expected behavior:
// - Má»—i láº§n click â†’ Counter tÄƒng â†’ Component re-render â†’ Effect log ra
// - Console output: "Component rendered with count: 0", "... count: 1", etc.
```

<details><summary>ğŸ’¡ Solution</summary>

```jsx
/**
 * LifecycleLogger - Level 1 Exercise
 * Má»¥c tiÃªu: Sá»­ dá»¥ng useEffect Ä‘á»ƒ log sau má»—i láº§n render
 * YÃªu cáº§u: Log "Component rendered" cÃ¹ng giÃ¡ trá»‹ count hiá»‡n táº¡i
 * KhÃ´ng dÃ¹ng dependencies array
 */
function LifecycleLogger() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log(`Component rendered with count: ${count}`);
  });

  return (
    <div>
      <h2>Lifecycle Logger</h2>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <p>ğŸ’¡ Má»Ÿ Console Ä‘á»ƒ xem log</p>
    </div>
  );
}

/*
Káº¿t quáº£ vÃ­ dá»¥ trong console khi tÆ°Æ¡ng tÃ¡c:

Component rendered with count: 0    â† mount láº§n Ä‘áº§u
Component rendered with count: 1    â† click láº§n 1
Component rendered with count: 2    â† click láº§n 2
Component rendered with count: 3    â† click láº§n 3
...
*/
```

</details>

---

### â­â­ Level 2: Nháº­n Biáº¿t Pattern (25 phÃºt)

```jsx
/**
 * ğŸ¯ Má»¥c tiÃªu: Biáº¿t khi nÃ o NÃŠN vÃ  KHÃ”NG NÃŠN dÃ¹ng useEffect
 * â±ï¸ Thá»i gian: 25 phÃºt
 *
 * Scenario: Báº¡n cÃ³ form Ä‘Äƒng nháº­p vá»›i username vÃ  password.
 * YÃªu cáº§u: Hiá»ƒn thá»‹ message "Welcome [username]!" khi user nháº­p xong.
 *
 * ğŸ¤” PHÃ‚N TÃCH:
 *
 * Approach A: DÃ¹ng useEffect Ä‘á»ƒ táº¡o welcome message
 * Pros:
 * - Effect cháº¡y sau render, Ä‘áº£m báº£o username Ä‘Ã£ update
 * - CÃ³ thá»ƒ log/track khi username thay Ä‘á»•i
 * Cons:
 * - KhÃ´ng cáº§n thiáº¿t! Welcome message cÃ³ thá»ƒ tÃ­nh TRá»°C TIáº¾P tá»« username
 * - Táº¡o thÃªm render cycle (effect â†’ setState â†’ re-render)
 * - Over-engineering
 *
 * Approach B: TÃ­nh welcome message trá»±c tiáº¿p (Derived State)
 * Pros:
 * - ÄÆ¡n giáº£n, dá»… hiá»ƒu
 * - KhÃ´ng táº¡o thÃªm render
 * - Performance tá»‘t hÆ¡n
 * Cons:
 * - KhÃ´ng log Ä‘Æ°á»£c khi username thay Ä‘á»•i (nhÆ°ng cÃ³ thá»ƒ log trong onChange)
 *
 * ğŸ’­ Báº N CHá»ŒN GÃŒ VÃ€ Táº I SAO?
 */

// âŒ Approach A: DÃ¹ng useEffect (KHÃ”NG Cáº¦N THIáº¾T!)
function LoginFormWithEffect() {
  const [username, setUsername] = useState('');
  const [welcomeMsg, setWelcomeMsg] = useState('');

  // âŒ KhÃ´ng cáº§n effect cho derived state!
  useEffect(() => {
    setWelcomeMsg(username ? `Welcome ${username}!` : '');
  });

  return (
    <div>
      <input
        value={username}
        onChange={(e) => setUsername(e.target.value)}
        placeholder='Username'
      />
      <p>{welcomeMsg}</p>
    </div>
  );
}

// âœ… Approach B: Derived State (Tá»T HÆ N!)
function LoginFormDerived() {
  const [username, setUsername] = useState('');

  // âœ… TÃ­nh trá»±c tiáº¿p, khÃ´ng cáº§n effect
  const welcomeMsg = username ? `Welcome ${username}!` : '';

  return (
    <div>
      <input
        value={username}
        onChange={(e) => setUsername(e.target.value)}
        placeholder='Username'
      />
      <p>{welcomeMsg}</p>
    </div>
  );
}

// ğŸ¯ NHIá»†M Vá»¤ Cá»¦A Báº N:
// 1. Implement Cáº¢ HAI approaches trÃªn
// 2. ThÃªm console.log Ä‘á»ƒ Ä‘áº¿m sá»‘ láº§n render
// 3. So sÃ¡nh hiá»‡u suáº¥t (count renders)
// 4. Viáº¿t comment giáº£i thÃ­ch approach nÃ o tá»‘t hÆ¡n vÃ  táº¡i sao
// 5. ÄÆ°a ra 2 vÃ­ dá»¥ KHI NÃ€O nÃªn dÃ¹ng useEffect cho tÆ°Æ¡ng tá»± use case

// ğŸ’¡ Gá»£i Ã½ cÃ¢u 5:
// - Khi nÃ o thÃ¬ PHáº¢I dÃ¹ng effect thay vÃ¬ derived state?
// - Hint: NghÄ© vá» side effects thá»±c sá»± (document.title, localStorage, API calls)
```

<details><summary>ğŸ’¡ Solution</summary>

```jsx
/**
 * Level 2: Nháº­n Biáº¿t Pattern - Final Answer
 * Approach B (Derived State) lÃ  lá»±a chá»n Ä‘Ãºng
 * useEffect KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c dÃ¹ng cho viá»‡c tÃ­nh toÃ¡n giÃ¡ trá»‹ hiá»ƒn thá»‹ tá»« state hiá»‡n táº¡i
 */

import { useState, useEffect } from 'react';

function LoginFormWithEffect() {
  const [username, setUsername] = useState('');
  const [welcomeMsg, setWelcomeMsg] = useState('');

  useEffect(() => {
    setWelcomeMsg(username ? `Welcome ${username}!` : '');
  }); // â† Sai hoÃ n toÃ n! Táº¡o re-render thá»«a

  return (
    <div>
      <input
        value={username}
        onChange={(e) => setUsername(e.target.value)}
      />
      <p>{welcomeMsg}</p>
    </div>
  );
}

function LoginFormDerived() {
  const [username, setUsername] = useState('');
  const welcomeMsg = username ? `Welcome ${username}!` : ''; // â† ÄÃºng cÃ¡ch!

  return (
    <div>
      <input
        value={username}
        onChange={(e) => setUsername(e.target.value)}
      />
      <p>{welcomeMsg}</p>
    </div>
  );
}

/*
Káº¿t quáº£ khi gÃµ "Grok":
- Approach A: 3 re-renders (1 ban Ä‘áº§u + 1 tá»« setUsername + 1 tá»« setWelcomeMsg)
- Approach B: Chá»‰ 2 re-renders (1 ban Ä‘áº§u + 1 tá»« setUsername)

Quy táº¯c vÃ ng:
- Náº¿u giÃ¡ trá»‹ chá»‰ dÃ¹ng Ä‘á»ƒ render â†’ Derived state
- Náº¿u áº£nh hÆ°á»Ÿng bÃªn ngoÃ i (title, localStorage, API, analytics...) â†’ useEffect
*/
```

</details>

---

### â­â­â­ Level 3: Ká»‹ch Báº£n Thá»±c Táº¿ (40 phÃºt)

```jsx
/**
 * ğŸ¯ Má»¥c tiÃªu: XÃ¢y dá»±ng Page Title Manager
 * â±ï¸ Thá»i gian: 40 phÃºt
 *
 * ğŸ“‹ Product Requirements:
 * User Story: "LÃ  ngÆ°á»i dÃ¹ng, tÃ´i muá»‘n tháº¥y browser tab title
 * pháº£n Ã¡nh Ä‘Ãºng trang tÃ´i Ä‘ang xem vÃ  sá»‘ notifications chÆ°a Ä‘á»c"
 *
 * âœ… Acceptance Criteria:
 * - [ ] Default title: "My App"
 * - [ ] Khi cÃ³ notifications: "My App (3)" - sá»‘ trong ngoáº·c
 * - [ ] Khi user á»Ÿ trang khÃ¡c: "[Page Name] - My App (3)"
 * - [ ] Title update ngay láº­p tá»©c khi:
 *   - Notifications count thay Ä‘á»•i
 *   - Page name thay Ä‘á»•i
 *
 * ğŸ¨ Technical Constraints:
 * - Chá»‰ dÃ¹ng useState vÃ  useEffect (Ä‘Ã£ há»c Ä‘áº¿n NgÃ y 16)
 * - KHÃ”NG dÃ¹ng dependencies array (chÆ°a há»c)
 * - KHÃ”NG dÃ¹ng useRef (chÆ°a há»c)
 *
 * ğŸš¨ Edge Cases cáº§n handle:
 * - Notifications = 0 â†’ KhÃ´ng hiá»ƒn thá»‹ "(0)"
 * - Page name = 'Home' â†’ Chá»‰ hiá»ƒn thá»‹ "My App"
 * - Notifications > 99 â†’ Hiá»ƒn thá»‹ "(99+)"
 *
 * ğŸ“ Implementation Checklist:
 * - [ ] State cho notifications count
 * - [ ] State cho current page name
 * - [ ] useEffect Ä‘á»ƒ sync document.title
 * - [ ] Buttons Ä‘á»ƒ test: increment/decrement notifications
 * - [ ] Buttons Ä‘á»ƒ switch pages
 * - [ ] Display current title trong UI
 */

// ğŸ¯ STARTER CODE:
function PageTitleManager() {
  const [notifications, setNotifications] = useState(0);
  const [currentPage, setCurrentPage] = useState('Home');

  // TODO: useEffect Ä‘á»ƒ update document.title
  // Logic:
  // 1. Náº¿u currentPage === 'Home' â†’ "My App"
  // 2. Náº¿u khÃ¡c â†’ "[Page Name] - My App"
  // 3. Náº¿u notifications > 0 â†’ thÃªm " (count)" hoáº·c " (99+)"

  const incrementNotifications = () => {
    // TODO: Implement
  };

  const decrementNotifications = () => {
    // TODO: Implement (khÃ´ng cho Ã¢m)
  };

  const goToPage = (pageName) => {
    // TODO: Implement
  };

  return (
    <div>
      <h2>Page Title Manager</h2>

      {/* Display current title */}
      <div>
        <strong>Current Title:</strong>
        <code>{/* TODO: Láº¥y document.title vÃ  hiá»ƒn thá»‹ */}</code>
      </div>

      {/* Notifications controls */}
      <div>
        <h3>Notifications: {notifications}</h3>
        {/* TODO: Buttons +1, -1, Reset */}
      </div>

      {/* Page navigation */}
      <div>
        <h3>Current Page: {currentPage}</h3>
        {/* TODO: Buttons cho Home, Profile, Settings, Messages */}
      </div>

      <div>
        <h3>Test Cases:</h3>
        <ul>
          <li>âœ… Home + 0 notifs â†’ "My App"</li>
          <li>âœ… Home + 3 notifs â†’ "My App (3)"</li>
          <li>âœ… Profile + 5 notifs â†’ "Profile - My App (5)"</li>
          <li>âœ… Messages + 100 notifs â†’ "Messages - My App (99+)"</li>
        </ul>
      </div>
    </div>
  );
}

// ğŸ’¡ HINTS:
// - DÃ¹ng template literals: `${page} - My App ${notifString}`
// - TÃ¡ch logic tÃ­nh title thÃ nh helper function
// - Test báº±ng cÃ¡ch má»Ÿ tab browser vÃ  xem title thay Ä‘á»•i
```

<details><summary>ğŸ’¡ Solution</summary>

```jsx
/**
 * PageTitleManager - Level 3 Exercise
 * YÃªu cáº§u: Quáº£n lÃ½ document.title dá»±a trÃªn trang hiá»‡n táº¡i vÃ  sá»‘ thÃ´ng bÃ¡o
 * Constraints: Chá»‰ dÃ¹ng useState + useEffect (khÃ´ng dÃ¹ng deps array)
 */
function PageTitleManager() {
  const [notifications, setNotifications] = useState(0);
  const [currentPage, setCurrentPage] = useState('Home');

  const getTitle = () => {
    let pagePart = currentPage === 'Home' ? '' : `${currentPage} - `;
    let notifPart = '';

    if (notifications > 0) {
      const displayCount = notifications > 99 ? '99+' : notifications;
      notifPart = `(${displayCount})`;
    }

    return `My App${pagePart ? ' ' + pagePart : ''}${notifPart}`.trim();
  };

  useEffect(() => {
    document.title = getTitle();
  });

  const incrementNotifications = () => setNotifications((n) => n + 1);
  const decrementNotifications = () =>
    setNotifications((n) => Math.max(0, n - 1));
  const resetNotifications = () => setNotifications(0);
  const goToPage = (pageName) => setCurrentPage(pageName);

  return (
    <div>
      <h2>Page Title Manager</h2>

      <div>
        <strong>Current Title:</strong> <code>{document.title}</code>
      </div>

      <div style={{ margin: '20px 0' }}>
        <h3>Notifications: {notifications}</h3>
        <button onClick={incrementNotifications}>+1</button>
        <button
          onClick={decrementNotifications}
          disabled={notifications === 0}
        >
          -1
        </button>
        <button onClick={resetNotifications}>Reset</button>
      </div>

      <div style={{ margin: '20px 0' }}>
        <h3>Current Page: {currentPage}</h3>
        <button onClick={() => goToPage('Home')}>Home</button>
        <button onClick={() => goToPage('Profile')}>Profile</button>
        <button onClick={() => goToPage('Settings')}>Settings</button>
        <button onClick={() => goToPage('Messages')}>Messages</button>
      </div>

      <div>
        <h3>Test Cases:</h3>
        <ul>
          <li>Home + 0 notifs â†’ "My App"</li>
          <li>Home + 3 notifs â†’ "My App (3)"</li>
          <li>Profile + 5 notifs â†’ "Profile - My App (5)"</li>
          <li>Messages + 100 notifs â†’ "Messages - My App (99+)"</li>
        </ul>
      </div>
    </div>
  );
}

/*
Káº¿t quáº£ vÃ­ dá»¥ khi tÆ°Æ¡ng tÃ¡c:

Mount ban Ä‘áº§u:
â†’ document.title = "My App"
â†’ UI hiá»ƒn thá»‹: Current Title: "My App"

Click +1 ba láº§n:
â†’ document.title = "My App (3)"

Click "Profile":
â†’ document.title = "Profile - My App (3)"

Click +1 Ä‘áº¿n 102:
â†’ document.title = "Profile - My App (99+)"

Click "Home" + Reset:
â†’ document.title = "My App"
*/
```

</details>

---

### â­â­â­â­ Level 4: Quyáº¿t Äá»‹nh Kiáº¿n TrÃºc (60 phÃºt)

```jsx
/**
 * ğŸ¯ Má»¥c tiÃªu: Thiáº¿t káº¿ Timer Component vá»›i nhiá»u features
 * â±ï¸ Thá»i gian: 60 phÃºt
 *
 * ğŸ—ï¸ PHASE 1: Research & Design (20 phÃºt)
 *
 * Context:
 * Báº¡n cáº§n xÃ¢y dá»±ng Timer component hiá»ƒn thá»‹ thá»i gian Ä‘Ã£ trÃ´i qua
 * ká»ƒ tá»« khi component mount. Timer cáº§n:
 * - Tá»± Ä‘á»™ng tick má»—i giÃ¢y
 * - CÃ³ thá»ƒ pause/resume
 * - Reset vá» 0
 * - Hiá»ƒn thá»‹ format MM:SS
 *
 * CÃ³ 3 approaches khÃ¡c nhau:
 *
 * APPROACH 1: setInterval trong useEffect (no dependencies)
 * Pros:
 * - ÄÆ¡n giáº£n, dá»… hiá»ƒu
 * - setInterval cháº¡y tá»± Ä‘á»™ng
 * Cons:
 * - Effect cháº¡y Má»–I render â†’ Táº¡o nhiá»u intervals!
 * - Memory leak (khÃ´ng clear interval)
 * - KhÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c khi nÃ o create interval
 *
 * APPROACH 2: setTimeout Ä‘á»‡ quy trong useEffect
 * Pros:
 * - ChÃ­nh xÃ¡c hÆ¡n setInterval
 * - Dá»… cleanup
 * Cons:
 * - Phá»©c táº¡p hÆ¡n
 * - Váº«n cÃ³ váº¥n Ä‘á» re-render
 *
 * APPROACH 3: setInterval + flag Ä‘á»ƒ prevent duplicate
 * Pros:
 * - Chá»‰ táº¡o 1 interval duy nháº¥t
 * - CÃ³ kiá»ƒm soÃ¡t
 * Cons:
 * - Cáº§n state phá»¥ Ä‘á»ƒ track (intervalId)
 * - Váº«n chÆ°a cleanup (sáº½ há»c á»Ÿ NgÃ y 18)
 *
 * ğŸ’­ NHIá»†M Vá»¤ PHASE 1:
 * 1. Implement cáº£ 3 approaches (prototype nhanh)
 * 2. Test vÃ  quan sÃ¡t behavior (má»Ÿ Console)
 * 3. Viáº¿t ADR (Architecture Decision Record)
 *
 * ADR Template:
 * ---
 * # ADR: Timer Implementation Strategy
 *
 * ## Context
 * [MÃ´ táº£ váº¥n Ä‘á»: Cáº§n timer auto-tick, cÃ³ pause/resume/reset]
 *
 * ## Decision
 * [Approach Ä‘Ã£ chá»n: Approach 3]
 *
 * ## Rationale
 * [Táº¡i sao chá»n Approach 3:
 *  - TrÃ¡nh Ä‘Æ°á»£c duplicate intervals
 *  - CÃ³ kiá»ƒm soÃ¡t lifecycle
 *  - Trade-off: Phá»©c táº¡p hÆ¡n nhÆ°ng á»•n Ä‘á»‹nh hÆ¡n]
 *
 * ## Consequences
 * [Trade-offs accepted:
 *  - Cáº§n state phá»¥ (intervalId)
 *  - Code dÃ i hÆ¡n
 *  - Váº«n cáº§n cleanup (TODO: NgÃ y 18)]
 *
 * ## Alternatives Considered
 * [Approach 1, 2 vÃ  táº¡i sao khÃ´ng chá»n]
 * ---
 */

// ğŸ’» PHASE 2: Implementation (30 phÃºt)

// âŒ APPROACH 1: setInterval no control (BROKEN)
function TimerApproach1() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    // âš ï¸ Váº¤N Äá»€: Effect cháº¡y Má»–I render
    // â†’ Má»—i láº§n seconds update â†’ Re-render â†’ Effect cháº¡y láº¡i â†’ Táº O INTERVAL Má»šI!
    const id = setInterval(() => {
      setSeconds((s) => s + 1);
    }, 1000);

    // âŒ KhÃ´ng return cleanup â†’ intervals chá»“ng chÃ©o!

    console.log('Created interval:', id);
  });

  return <div>Seconds: {seconds}</div>;
}

// âŒ APPROACH 2: setTimeout recursive (BETTER nhÆ°ng váº«n cÃ³ issue)
function TimerApproach2() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    // Váº«n cháº¡y má»—i render!
    const id = setTimeout(() => {
      setSeconds((s) => s + 1);
    }, 1000);

    console.log('Created timeout:', id);

    // Cleanup tá»‘t hÆ¡n nhÆ°ng váº«n táº¡o nhiá»u timeouts
  });

  return <div>Seconds: {seconds}</div>;
}

// âœ… APPROACH 3: Controlled vá»›i flag (BEST cho NgÃ y 16)
function TimerApproach3() {
  const [seconds, setSeconds] = useState(0);
  const [isRunning, setIsRunning] = useState(true);
  const [intervalId, setIntervalId] = useState(null);

  useEffect(() => {
    // Chá»‰ táº¡o interval náº¿u chÆ°a cÃ³ VÃ€ Ä‘ang running
    if (isRunning && !intervalId) {
      const id = setInterval(() => {
        setSeconds((s) => s + 1);
      }, 1000);

      setIntervalId(id);
      console.log('âœ… Created interval:', id);
    }

    // Náº¿u pause, clear interval
    if (!isRunning && intervalId) {
      clearInterval(intervalId);
      setIntervalId(null);
      console.log('â¸ï¸ Cleared interval:', intervalId);
    }
  });

  const toggle = () => setIsRunning(!isRunning);

  const reset = () => {
    if (intervalId) clearInterval(intervalId);
    setIntervalId(null);
    setSeconds(0);
    setIsRunning(true);
  };

  // Format MM:SS
  const formatTime = (totalSeconds) => {
    const mins = Math.floor(totalSeconds / 60);
    const secs = totalSeconds % 60;
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  };

  return (
    <div>
      <h2>Timer: {formatTime(seconds)}</h2>
      <button onClick={toggle}>{isRunning ? 'â¸ï¸ Pause' : 'â–¶ï¸ Resume'}</button>
      <button onClick={reset}>ğŸ”„ Reset</button>

      <p>Status: {isRunning ? 'Running' : 'Paused'}</p>
      <p>Interval ID: {intervalId || 'None'}</p>
    </div>
  );
}

// ğŸ¯ NHIá»†M Vá»¤ Cá»¦A Báº N:
// 1. Implement cáº£ 3 approaches
// 2. Test tá»«ng approach, má»Ÿ Console Ä‘á»ƒ xem intervals/timeouts Ä‘Æ°á»£c táº¡o
// 3. Viáº¿t ADR document chá»n approach tá»‘t nháº¥t
// 4. Extend Approach 3 thÃªm:
//    - Lap counter (Ä‘áº¿m vÃ²ng)
//    - Max time alert (cáº£nh bÃ¡o khi > 5 phÃºt)

// ğŸ§ª PHASE 3: Testing (10 phÃºt)
// Manual testing checklist:
// - [ ] Timer ticks Ä‘á»u Ä‘áº·n má»—i giÃ¢y
// - [ ] Pause â†’ Timer dá»«ng
// - [ ] Resume â†’ Timer tiáº¿p tá»¥c tá»« giÃ¡ trá»‹ cÅ©
// - [ ] Reset â†’ Timer vá» 0 vÃ  cháº¡y láº¡i
// - [ ] Console khÃ´ng spam "Created interval"
// - [ ] Format MM:SS Ä‘Ãºng (00:00, 01:23, 10:59, etc.)
```

<details><summary>ğŸ’¡ Solution</summary>

```jsx
/**
 * TimerApproach3 - Level 4 Exercise (Best approach for Day 16)
 * Features: auto-tick every second, pause/resume, reset
 * Uses controlled interval with state flag to prevent duplicates
 * Format: MM:SS
 */
function TimerApproach3() {
  const [seconds, setSeconds] = useState(0);
  const [isRunning, setIsRunning] = useState(true);
  const [intervalId, setIntervalId] = useState(null);

  useEffect(() => {
    if (isRunning && !intervalId) {
      const id = setInterval(() => {
        setSeconds((s) => s + 1);
      }, 1000);

      setIntervalId(id);
      console.log('Created interval:', id);
    }

    if (!isRunning && intervalId) {
      clearInterval(intervalId);
      setIntervalId(null);
      console.log('Cleared interval:', intervalId);
    }

    // Note: Cleanup sáº½ Ä‘Æ°á»£c há»c á»Ÿ NgÃ y 18
    // return () => { if (intervalId) clearInterval(intervalId); };
  });

  const toggle = () => setIsRunning(!isRunning);

  const reset = () => {
    if (intervalId) {
      clearInterval(intervalId);
      setIntervalId(null);
    }
    setSeconds(0);
    setIsRunning(true);
  };

  const formatTime = (totalSeconds) => {
    const mins = Math.floor(totalSeconds / 60);
    const secs = totalSeconds % 60;
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  };

  return (
    <div>
      <h2>Timer: {formatTime(seconds)}</h2>
      <button onClick={toggle}>{isRunning ? 'â¸ï¸ Pause' : 'â–¶ï¸ Resume'}</button>
      <button onClick={reset}>ğŸ”„ Reset</button>

      <p>Status: {isRunning ? 'Running' : 'Paused'}</p>
      <p>Interval ID: {intervalId || 'None'}</p>

      <p style={{ fontSize: '0.9em', color: '#666', marginTop: '2rem' }}>
        Approach Ä‘Æ°á»£c chá»n: Approach 3 (Controlled interval vá»›i flag)
        <br />
        LÃ½ do: TrÃ¡nh duplicate intervals, dá»… kiá»ƒm soÃ¡t, á»•n Ä‘á»‹nh nháº¥t trong giá»›i
        háº¡n Day 16
      </p>
    </div>
  );
}

/*
Káº¿t quáº£ vÃ­ dá»¥ khi tÆ°Æ¡ng tÃ¡c:

Mount ban Ä‘áº§u:
â†’ Timer: 00:00
â†’ Status: Running
â†’ Console: Created interval: [some number]

Sau 5 giÃ¢y:
â†’ Timer: 00:05

Click Pause:
â†’ Timer: 00:05 (dá»«ng)
â†’ Status: Paused
â†’ Console: Cleared interval: [number]

Click Resume:
â†’ Tiáº¿p tá»¥c tá»« 00:05 â†’ 00:06, 00:07...
â†’ Console: Created interval: [new number]

Click Reset:
â†’ Timer: 00:00
â†’ Status: Running
â†’ Console: Cleared interval: [old number]
     Created interval: [new number]
*/
```

</details>

---

### â­â­â­â­â­ Level 5: Production Challenge (90 phÃºt)

```jsx
/**
 * ğŸ¯ Má»¥c tiÃªu: Activity Tracker Dashboard
 * â±ï¸ Thá»i gian: 90 phÃºt
 *
 * ğŸ“‹ Feature Specification:
 * XÃ¢y dá»±ng dashboard track user activity:
 * 1. Time on page (thá»i gian á»Ÿ trÃªn trang)
 * 2. Mouse movements counter
 * 3. Keyboard presses counter
 * 4. Scroll depth tracker
 * 5. Tab visibility tracker (active/inactive)
 * 6. Activity summary (active/idle)
 *
 * ğŸ—ï¸ Technical Design Doc:
 *
 * 1. Component Architecture:
 *    - ActivityDashboard (parent)
 *    - TimeTracker (time on page)
 *    - MouseTracker (movement count)
 *    - KeyboardTracker (keypress count)
 *    - ScrollTracker (scroll %)
 *    - VisibilityTracker (tab active/hidden)
 *    - ActivitySummary (overall stats)
 *
 * 2. State Management Strategy:
 *    - Má»—i tracker cÃ³ state riÃªng
 *    - Parent aggregate táº¥t cáº£ stats
 *    - Lift state up pattern
 *
 * 3. Side Effects (useEffect usage):
 *    - setInterval cho time counter
 *    - Event listeners: mousemove, keydown, scroll, visibilitychange
 *    - âš ï¸ Cleanup Ä‘á»ƒ prevent memory leaks (sáº½ há»c á»Ÿ NgÃ y 18, nhÆ°ng cáº§n mention)
 *
 * 4. Performance Considerations:
 *    - Throttle mousemove events (má»—i 100ms má»›i update)
 *    - Debounce scroll tracking
 *    - Avoid re-rendering toÃ n bá»™ dashboard má»—i event
 *
 * 5. Error Handling Strategy:
 *    - Graceful degradation náº¿u browser khÃ´ng support API
 *    - Fallback values
 *
 * âœ… Production Checklist:
 * - [ ] State cho má»—i metric
 * - [ ] useEffect cho timers vÃ  event listeners
 * - [ ] Event handlers vá»›i throttle/debounce
 * - [ ] Conditional rendering cho empty states
 * - [ ] Accessibility: keyboard navigation, ARIA labels
 * - [ ] Display metrics trong clear, readable format
 * - [ ] Reset button Ä‘á»ƒ clear táº¥t cáº£ metrics
 * - [ ] Visual indicators (icons, colors)
 * - [ ] Responsive layout
 * - [ ] Comments giáº£i thÃ­ch logic
 *
 * ğŸ“ Documentation:
 * - README.md:
 *   - Feature overview
 *   - How to use
 *   - Metrics explained
 * - Code comments:
 *   - Táº¡i sao throttle/debounce
 *   - Event listener logic
 *   - State update patterns
 *
 * ğŸ” Code Review Self-Checklist:
 * - [ ] KhÃ´ng cÃ³ memory leaks (mention cáº§n cleanup)
 * - [ ] Events Ä‘Æ°á»£c throttle/debounce Ä‘Ãºng cÃ¡ch
 * - [ ] State updates khÃ´ng gÃ¢y infinite loops
 * - [ ] UI responsive vÃ  accessible
 * - [ ] Code readable vá»›i comments
 */

// ğŸ¯ STARTER CODE & REQUIREMENTS:

import { useState, useEffect } from 'react';

// Helper: Simple throttle
function throttle(func, delay) {
  let lastCall = 0;
  return function (...args) {
    const now = Date.now();
    if (now - lastCall >= delay) {
      lastCall = now;
      func(...args);
    }
  };
}

// TODO: Implement TimeTracker
function TimeTracker({ onTimeUpdate }) {
  const [seconds, setSeconds] = useState(0);

  // TODO: useEffect vá»›i setInterval
  // Update every second
  // Call onTimeUpdate(seconds) Ä‘á»ƒ parent biáº¿t

  const formatTime = (secs) => {
    const h = Math.floor(secs / 3600);
    const m = Math.floor((secs % 3600) / 60);
    const s = secs % 60;
    return `${h}h ${m}m ${s}s`;
  };

  return (
    <div className='tracker-card'>
      <h3>â±ï¸ Time on Page</h3>
      <div className='metric'>{formatTime(seconds)}</div>
    </div>
  );
}

// TODO: Implement MouseTracker
function MouseTracker({ onMouseMove }) {
  const [moves, setMoves] = useState(0);

  useEffect(() => {
    // TODO: Add mousemove listener vá»›i throttle
    // Throttle: chá»‰ count má»—i 100ms
    // Increment moves
    // Call onMouseMove(moves)
    // âš ï¸ LÆ¯U Ã: Cáº§n cleanup listener (mention nhÆ°ng chÆ°a implement)
  });

  return (
    <div className='tracker-card'>
      <h3>ğŸ–±ï¸ Mouse Movements</h3>
      <div className='metric'>{moves}</div>
    </div>
  );
}

// TODO: Implement KeyboardTracker
function KeyboardTracker({ onKeyPress }) {
  // TODO: Track keypress count
  // Add keydown listener
  // Update count
  // Call onKeyPress(count)

  return (
    <div className='tracker-card'>
      <h3>âŒ¨ï¸ Key Presses</h3>
      <div className='metric'>{/* count */}</div>
    </div>
  );
}

// TODO: Implement ScrollTracker
function ScrollTracker({ onScroll }) {
  const [scrollPercent, setScrollPercent] = useState(0);

  useEffect(() => {
    // TODO: Add scroll listener
    // Calculate scroll percentage:
    // (scrollTop / (scrollHeight - clientHeight)) * 100
    // Throttle updates
    // Call onScroll(percent)
  });

  return (
    <div className='tracker-card'>
      <h3>ğŸ“œ Scroll Depth</h3>
      <div className='metric'>{scrollPercent.toFixed(1)}%</div>
      <div className='progress-bar'>
        <div
          className='progress'
          style={{ width: `${scrollPercent}%` }}
        />
      </div>
    </div>
  );
}

// TODO: Implement VisibilityTracker
function VisibilityTracker({ onVisibilityChange }) {
  const [isVisible, setIsVisible] = useState(true);

  useEffect(() => {
    // TODO: Add visibilitychange listener
    // Update isVisible based on document.hidden
    // Call onVisibilityChange(isVisible)
  });

  return (
    <div className='tracker-card'>
      <h3>ğŸ‘ï¸ Tab Visibility</h3>
      <div className='metric'>{isVisible ? 'âœ… Active' : 'â¸ï¸ Hidden'}</div>
    </div>
  );
}

// TODO: Implement ActivitySummary
function ActivitySummary({ stats }) {
  // TODO: Determine activity status
  // Active náº¿u: mouseMoves > 10 OR keyPresses > 5 OR scrollPercent > 0
  // trong vÃ²ng last 30 giÃ¢y

  const isActive = false; // TODO: Calculate

  return (
    <div className='summary-card'>
      <h3>ğŸ“Š Activity Summary</h3>
      <div className={`status ${isActive ? 'active' : 'idle'}`}>
        {isActive ? 'ğŸŸ¢ ACTIVE' : 'ğŸ”´ IDLE'}
      </div>
      <div className='stats-grid'>
        <div>Time: {/* stats.time */}</div>
        <div>Moves: {/* stats.moves */}</div>
        <div>Keys: {/* stats.keys */}</div>
        <div>Scroll: {/* stats.scroll */}%</div>
      </div>
    </div>
  );
}

// Main Dashboard
function ActivityDashboard() {
  const [stats, setStats] = useState({
    time: 0,
    moves: 0,
    keys: 0,
    scroll: 0,
    isVisible: true,
  });

  // TODO: Implement update handlers
  const handleTimeUpdate = (time) => {
    setStats((prev) => ({ ...prev, time }));
  };

  // TODO: Similar handlers cho moves, keys, scroll, visibility

  const handleReset = () => {
    // TODO: Reset all stats
    // Reload page hoáº·c reset states
  };

  return (
    <div className='dashboard'>
      <header>
        <h1>ğŸ“Š Activity Tracker Dashboard</h1>
        <button onClick={handleReset}>ğŸ”„ Reset All</button>
      </header>

      <div className='trackers-grid'>
        <TimeTracker onTimeUpdate={handleTimeUpdate} />
        {/* TODO: Render other trackers */}
      </div>

      <ActivitySummary stats={stats} />

      <footer>
        <p>ğŸ’¡ Interact with the page to see metrics update!</p>
        <p>âš ï¸ Note: This demo does NOT cleanup listeners yet (NgÃ y 18)</p>
      </footer>
    </div>
  );
}

// ğŸ¨ CSS (Optional - focus on functionality first):
const styles = `
  .dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .trackers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
  }
  
  .tracker-card, .summary-card {
    padding: 1.5rem;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
  }
  
  .metric {
    font-size: 2rem;
    font-weight: bold;
    margin: 1rem 0;
  }
  
  .progress-bar {
    height: 8px;
    background: #eee;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .progress {
    height: 100%;
    background: #4CAF50;
    transition: width 0.3s;
  }
  
  .status.active {
    color: #4CAF50;
  }
  
  .status.idle {
    color: #f44336;
  }
`;

// ğŸ“‹ ACCEPTANCE CRITERIA:
// - [ ] Time tracker ticks má»—i giÃ¢y
// - [ ] Mouse movements Ä‘Æ°á»£c count (throttled)
// - [ ] Keyboard presses Ä‘Æ°á»£c count
// - [ ] Scroll depth updates khi scroll
// - [ ] Visibility tracker pháº£n Ã¡nh tab active/hidden
// - [ ] Activity summary hiá»ƒn thá»‹ status Ä‘Ãºng
// - [ ] Reset button clear táº¥t cáº£ metrics
// - [ ] UI responsive vÃ  dá»… Ä‘á»c
// - [ ] Code cÃ³ comments giáº£i thÃ­ch logic
// - [ ] KhÃ´ng cÃ³ console errors

export default ActivityDashboard;
```

<details><summary>ğŸ’¡ Solution</summary>

```jsx
/**
 * ActivityDashboard - Level 5 Production Challenge
 * Features: Track time on page, mouse movements, key presses, scroll depth, tab visibility
 * Uses throttled event listeners + interval
 * Note: Cleanup functions are commented (to be implemented in Day 18)
 */
import { useState, useEffect } from 'react';

// Simple throttle helper
function throttle(func, limit) {
  let inThrottle;
  return function (...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
    }
  };
}

function TimeTracker({ onTimeUpdate }) {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setSeconds((s) => {
        const newSeconds = s + 1;
        onTimeUpdate(newSeconds);
        return newSeconds;
      });
    }, 1000);

    // return () => clearInterval(interval); // Day 18 cleanup
  }, []);

  const formatTime = (secs) => {
    const h = Math.floor(secs / 3600);
    const m = Math.floor((secs % 3600) / 60);
    const s = secs % 60;
    return `${h ? h + 'h ' : ''}${m}m ${s}s`.trim();
  };

  return (
    <div
      style={{ border: '1px solid #ddd', padding: '1rem', borderRadius: '8px' }}
    >
      <h3>â±ï¸ Time on Page</h3>
      <div style={{ fontSize: '1.8rem', fontWeight: 'bold' }}>
        {formatTime(seconds)}
      </div>
    </div>
  );
}

function MouseTracker({ onMouseMove }) {
  const [moves, setMoves] = useState(0);

  useEffect(() => {
    const handleMove = throttle(() => {
      setMoves((m) => {
        const newMoves = m + 1;
        onMouseMove(newMoves);
        return newMoves;
      });
    }, 100);

    window.addEventListener('mousemove', handleMove);
    // return () => window.removeEventListener('mousemove', handleMove); // Day 18
  }, []);

  return (
    <div
      style={{ border: '1px solid #ddd', padding: '1rem', borderRadius: '8px' }}
    >
      <h3>ğŸ–±ï¸ Mouse Movements</h3>
      <div style={{ fontSize: '1.8rem', fontWeight: 'bold' }}>{moves}</div>
    </div>
  );
}

function KeyboardTracker({ onKeyPress }) {
  const [keys, setKeys] = useState(0);

  useEffect(() => {
    const handleKey = () => {
      setKeys((k) => {
        const newKeys = k + 1;
        onKeyPress(newKeys);
        return newKeys;
      });
    };

    window.addEventListener('keydown', handleKey);
    // return () => window.removeEventListener('keydown', handleKey); // Day 18
  }, []);

  return (
    <div
      style={{ border: '1px solid #ddd', padding: '1rem', borderRadius: '8px' }}
    >
      <h3>âŒ¨ï¸ Key Presses</h3>
      <div style={{ fontSize: '1.8rem', fontWeight: 'bold' }}>{keys}</div>
    </div>
  );
}

function ScrollTracker({ onScroll }) {
  const [scrollPercent, setScrollPercent] = useState(0);

  useEffect(() => {
    const handleScroll = throttle(() => {
      const winScroll = document.documentElement.scrollTop;
      const height =
        document.documentElement.scrollHeight -
        document.documentElement.clientHeight;
      const scrolled = height > 0 ? (winScroll / height) * 100 : 0;

      setScrollPercent(scrolled);
      onScroll(scrolled);
    }, 150);

    window.addEventListener('scroll', handleScroll);
    // return () => window.removeEventListener('scroll', handleScroll); // Day 18
  }, []);

  return (
    <div
      style={{ border: '1px solid #ddd', padding: '1rem', borderRadius: '8px' }}
    >
      <h3>ğŸ“œ Scroll Depth</h3>
      <div style={{ fontSize: '1.8rem', fontWeight: 'bold' }}>
        {scrollPercent.toFixed(1)}%
      </div>
      <div
        style={{
          height: '8px',
          background: '#eee',
          borderRadius: '4px',
          overflow: 'hidden',
          marginTop: '0.5rem',
        }}
      >
        <div
          style={{
            height: '100%',
            width: `${scrollPercent}%`,
            background: '#4CAF50',
            transition: 'width 0.2s',
          }}
        />
      </div>
    </div>
  );
}

function VisibilityTracker({ onVisibilityChange }) {
  const [isVisible, setIsVisible] = useState(!document.hidden);

  useEffect(() => {
    const handleVisibility = () => {
      const visible = !document.hidden;
      setIsVisible(visible);
      onVisibilityChange(visible);
    };

    document.addEventListener('visibilitychange', handleVisibility);
    // return () => document.removeEventListener('visibilitychange', handleVisibility); // Day 18
  }, []);

  return (
    <div
      style={{ border: '1px solid #ddd', padding: '1rem', borderRadius: '8px' }}
    >
      <h3>ğŸ‘ï¸ Tab Visibility</h3>
      <div
        style={{
          fontSize: '1.5rem',
          fontWeight: 'bold',
          color: isVisible ? '#4CAF50' : '#f44336',
        }}
      >
        {isVisible ? 'âœ… Active' : 'â¸ï¸ Hidden'}
      </div>
    </div>
  );
}

function ActivityDashboard() {
  const [stats, setStats] = useState({
    time: 0,
    moves: 0,
    keys: 0,
    scroll: 0,
    isVisible: true,
  });

  const handleTimeUpdate = (time) => setStats((prev) => ({ ...prev, time }));
  const handleMouseUpdate = (moves) => setStats((prev) => ({ ...prev, moves }));
  const handleKeyUpdate = (keys) => setStats((prev) => ({ ...prev, keys }));
  const handleScrollUpdate = (scroll) =>
    setStats((prev) => ({ ...prev, scroll }));
  const handleVisibilityUpdate = (isVisible) =>
    setStats((prev) => ({ ...prev, isVisible }));

  const isActive =
    stats.moves > 5 || stats.keys > 3 || stats.scroll > 1 || stats.time < 10;

  const handleReset = () => {
    setStats({
      time: 0,
      moves: 0,
      keys: 0,
      scroll: 0,
      isVisible: !document.hidden,
    });
  };

  return (
    <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem' }}>
      <header
        style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
        }}
      >
        <h1>ğŸ“Š Activity Tracker Dashboard</h1>
        <button
          onClick={handleReset}
          style={{ padding: '0.6rem 1.2rem', fontSize: '1rem' }}
        >
          ğŸ”„ Reset All
        </button>
      </header>

      <div
        style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))',
          gap: '1.5rem',
          margin: '2rem 0',
        }}
      >
        <TimeTracker onTimeUpdate={handleTimeUpdate} />
        <MouseTracker onMouseMove={handleMouseUpdate} />
        <KeyboardTracker onKeyPress={handleKeyUpdate} />
        <ScrollTracker onScroll={handleScrollUpdate} />
        <VisibilityTracker onVisibilityChange={handleVisibilityUpdate} />
      </div>

      <div
        style={{
          border: '1px solid #ddd',
          padding: '1.5rem',
          borderRadius: '8px',
          background: '#f9f9f9',
        }}
      >
        <h3>ğŸ“Š Activity Summary</h3>
        <div
          style={{
            fontSize: '2rem',
            fontWeight: 'bold',
            color: isActive ? '#4CAF50' : '#f44336',
            margin: '1rem 0',
          }}
        >
          {isActive ? 'ğŸŸ¢ ACTIVE' : 'ğŸ”´ IDLE'}
        </div>
        <div
          style={{
            display: 'grid',
            gridTemplateColumns: '1fr 1fr',
            gap: '1rem',
          }}
        >
          <div>Time: {stats.time}s</div>
          <div>Moves: {stats.moves}</div>
          <div>Keys: {stats.keys}</div>
          <div>Scroll: {stats.scroll.toFixed(1)}%</div>
        </div>
      </div>

      <footer style={{ marginTop: '2rem', color: '#666', fontSize: '0.9rem' }}>
        <p>
          Interact with the page (move mouse, type, scroll, switch tabs) to see
          metrics update!
        </p>
        <p>Note: Event listeners cleanup will be added on Day 18</p>
      </footer>
    </div>
  );
}

/*
Káº¿t quáº£ vÃ­ dá»¥ khi tÆ°Æ¡ng tÃ¡c:

Mount â†’ Time báº¯t Ä‘áº§u tÄƒng má»—i giÃ¢y
Di chuyá»ƒn chuá»™t â†’ Mouse Movements tÄƒng (throttled ~ má»—i 100ms)
Nháº¥n phÃ­m â†’ Key Presses tÄƒng
Cuá»™n trang â†’ Scroll Depth thay Ä‘á»•i mÆ°á»£t
Chuyá»ƒn tab â†’ Tab Visibility chuyá»ƒn sang "Hidden"
Táº¥t cáº£ thay Ä‘á»•i â†’ Activity Summary cáº­p nháº­t tráº¡ng thÃ¡i ACTIVE/IDLE
Click Reset â†’ Táº¥t cáº£ vá» 0, time tiáº¿p tá»¥c Ä‘áº¿m tá»« Ä‘áº§u
*/
```

</details>

---

## ğŸ“Š PHáº¦N 4: SO SÃNH PATTERNS (30 phÃºt)

### Báº£ng So SÃ¡nh: useEffect vs Direct Execution

| TiÃªu chÃ­        | Direct trong Render    | useEffect                   | Event Handler          |
| --------------- | ---------------------- | --------------------------- | ---------------------- |
| **Timing**      | TRONG quÃ¡ trÃ¬nh render | SAU khi render xong         | Khi user action xáº£y ra |
| **Blocking**    | Block rendering        | KhÃ´ng block                 | KhÃ´ng block            |
| **Use case**    | TÃ­nh toÃ¡n UI           | Side effects sync vá»›i state | Respond to user        |
| **VÃ­ dá»¥**       | Derived state          | document.title, fetch       | onClick, onSubmit      |
| **Runs**        | Má»—i láº§n render         | Theo dependencies           | Khi Ä‘Æ°á»£c trigger       |
| **Performance** | CÃ³ thá»ƒ cháº­m render     | KhÃ´ng áº£nh hÆ°á»Ÿng render      | On-demand              |

### Báº£ng So SÃ¡nh: useEffect vá»›i/khÃ´ng Dependencies

| TiÃªu chÃ­     | KhÃ´ng cÃ³ deps         | deps = []                 | deps = [a, b]                 |
| ------------ | --------------------- | ------------------------- | ----------------------------- |
| **Syntax**   | `useEffect(() => {})` | `useEffect(() => {}, [])` | `useEffect(() => {}, [a, b])` |
| **Cháº¡y khi** | Má»–I render            | CHá»ˆ mount (1 láº§n)         | Khi a hoáº·c b thay Ä‘á»•i         |
| **NgÃ y há»c** | NgÃ y 16 âœ…            | NgÃ y 17                   | NgÃ y 17                       |
| **Use case** | Log má»i render        | Setup 1 láº§n               | Sync vá»›i specific state       |
| **Váº¥n Ä‘á»**   | Cháº¡y quÃ¡ nhiá»u        | KhÃ´ng update khi cáº§n      | Stale closure (NgÃ y 17)       |

**âš ï¸ LÆ¯U Ã QUAN TRá»ŒNG:**

- HÃ´m nay (NgÃ y 16) chá»‰ há»c useEffect KHÃ”NG cÃ³ dependencies
- NgÃ y 17 sáº½ há»c dependencies array chi tiáº¿t
- NgÃ y 18 sáº½ há»c cleanup function

---

### Decision Tree: Khi nÃ o dÃ¹ng useEffect?

```
Báº¡n cáº§n lÃ m gÃ¬ Ä‘Ã³ trong component?
â”‚
â”œâ”€ TÃ­nh toÃ¡n tá»« props/state Ä‘á»ƒ render UI?
â”‚  â†’ KHÃ”NG dÃ¹ng useEffect, tÃ­nh trá»±c tiáº¿p (Derived State)
â”‚  â†’ VÃ­ dá»¥: const fullName = firstName + " " + lastName;
â”‚
â”œâ”€ Respond to user action? (click, type, submit)
â”‚  â†’ KHÃ”NG dÃ¹ng useEffect, dÃ¹ng Event Handler
â”‚  â†’ VÃ­ dá»¥: onClick={() => handleClick()}
â”‚
â”œâ”€ LÃ m gÃ¬ Ä‘Ã³ BÃŠN NGOÃ€I component? (Side Effect)
â”‚  â”‚
â”‚  â”œâ”€ Cáº§n cháº¡y SAU Má»–II render?
â”‚  â”‚  â†’ useEffect(() => { ... })  // No deps
â”‚  â”‚  â†’ VÃ­ dá»¥: Log má»i render
â”‚  â”‚
â”‚  â”œâ”€ Cáº§n cháº¡y 1 Láº¦N khi mount?
â”‚  â”‚  â†’ useEffect(() => { ... }, [])  // Empty deps (NgÃ y 17)
â”‚  â”‚  â†’ VÃ­ dá»¥: Fetch initial data
â”‚  â”‚
â”‚  â””â”€ Cáº§n cháº¡y khi SPECIFIC value thay Ä‘á»•i?
â”‚     â†’ useEffect(() => { ... }, [value])  // With deps (NgÃ y 17)
â”‚     â†’ VÃ­ dá»¥: Update document.title khi count thay Ä‘á»•i
â”‚
â””â”€ KhÃ´ng cháº¯c?
   â†’ Há»i: "Äiá»u nÃ y cÃ³ áº£nh hÆ°á»Ÿng thá»© bÃªn ngoÃ i component khÃ´ng?"
   â†’ Náº¿u YES â†’ useEffect
   â†’ Náº¿u NO â†’ TÃ­nh trá»±c tiáº¿p hoáº·c event handler
```

---

## ğŸ§ª PHáº¦N 5: DEBUG LAB (20 phÃºt)

### Bug #1: Infinite Loop ğŸ”¥

```jsx
/**
 * ğŸ› BUG: Component re-render vÃ´ háº¡n
 * ğŸ¯ Nhiá»‡m vá»¥: TÃ¬m lá»—i vÃ  sá»­a
 */

function BuggyCounter() {
  const [count, setCount] = useState(0);
  const [double, setDouble] = useState(0);

  // âŒ BUG: VÃ²ng láº·p vÃ´ háº¡n!
  useEffect(() => {
    setDouble(count * 2);
  });

  return (
    <div>
      <p>Count: {count}</p>
      <p>Double: {double}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}

// ğŸ¤” CÃ‚U Há»I DEBUG:
// 1. Táº¡i sao component re-render vÃ´ háº¡n?
// 2. Effect cháº¡y khi nÃ o?
// 3. setDouble() lÃ m gÃ¬?

// ğŸ’¡ GIáº¢I THÃCH:
// - useEffect (no deps) cháº¡y SAU Má»–I render
// - setDouble() trigger re-render
// - Re-render â†’ useEffect cháº¡y láº¡i â†’ setDouble() â†’ Re-render â†’ ...
// â†’ INFINITE LOOP!

// âœ… CÃCH Sá»¬A (vá»›i kiáº¿n thá»©c NgÃ y 16):
function FixedCounter() {
  const [count, setCount] = useState(0);

  // âœ… TÃ­nh trá»±c tiáº¿p, KHÃ”NG dÃ¹ng useEffect cho derived state
  const double = count * 2;

  return (
    <div>
      <p>Count: {count}</p>
      <p>Double: {double}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}

// ğŸ“ BÃ€I Há»ŒC:
// - useEffect cho side effects, KHÃ”NG cho derived state
// - Calling setState trong effect â†’ Cáº©n tháº­n vá»›i infinite loops!
// - NgÃ y 17 sáº½ há»c dependencies array Ä‘á»ƒ control khi nÃ o effect cháº¡y
```

---

### Bug #2: Effect trong Event Handler ğŸ¤”

```jsx
/**
 * ğŸ› BUG: Láº«n lá»™n useEffect vÃ  event handler
 * ğŸ¯ Nhiá»‡m vá»¥: Sá»­a logic
 */

function BuggyForm() {
  const [name, setName] = useState('');
  const [submitted, setSubmitted] = useState(false);

  // âŒ BUG: DÃ¹ng useEffect cho user action!
  useEffect(() => {
    if (name.length > 0) {
      // Effect cháº¡y Má»–I khi name thay Ä‘á»•i, KHÃ”NG pháº£i khi submit!
      setSubmitted(true);
      console.log('Form submitted:', name);
    }
  });

  return (
    <div>
      <input
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder='Your name'
      />
      {/* Button khÃ´ng lÃ m gÃ¬ cáº£! */}
      <button>Submit</button>
      {submitted && <p>Thanks {name}!</p>}
    </div>
  );
}

// ğŸ¤” CÃ‚U Há»I DEBUG:
// 1. Khi nÃ o "Form submitted" Ä‘Æ°á»£c log?
// 2. Button "Submit" cÃ³ Ä‘Æ°á»£c dÃ¹ng khÃ´ng?
// 3. Logic submit cÃ³ Ä‘Ãºng khÃ´ng?

// ğŸ’¡ GIáº¢I THÃCH:
// - Effect cháº¡y má»—i khi `name` thay Ä‘á»•i (má»—i keystroke!)
// - Button onClick khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
// - Logic submit cháº¡y sai thá»i Ä‘iá»ƒm

// âœ… CÃCH Sá»¬A:
function FixedForm() {
  const [name, setName] = useState('');
  const [submitted, setSubmitted] = useState(false);

  // âœ… DÃ¹ng event handler cho user action
  const handleSubmit = () => {
    if (name.length > 0) {
      setSubmitted(true);
      console.log('Form submitted:', name);
    }
  };

  return (
    <div>
      <input
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder='Your name'
      />
      <button onClick={handleSubmit}>Submit</button>
      {submitted && <p>Thanks {name}!</p>}
    </div>
  );
}

// ğŸ“ BÃ€I Há»ŒC:
// - useEffect: Cho side effects SYNC vá»›i state (auto)
// - Event handlers: Cho side effects tá»« USER ACTIONS (manual)
// - KHÃ”NG dÃ¹ng effect cho logic respond to clicks/submissions!
```

---

### Bug #3: Multiple State Updates ğŸš¨

```jsx
/**
 * ğŸ› BUG: Performance issue vá»›i nhiá»u state updates
 * ğŸ¯ Nhiá»‡m vá»¥: Optimize
 */

function BuggyWeatherWidget() {
  const [temp, setTemp] = useState(20);
  const [humidity, setHumidity] = useState(50);
  const [condition, setCondition] = useState('Sunny');

  // âŒ BUG: 3 effects riÃªng biá»‡t, má»—i cÃ¡i trigger re-render
  useEffect(() => {
    document.title = `${temp}Â°C`;
  });

  useEffect(() => {
    document.title = `${temp}Â°C, ${humidity}%`;
  });

  useEffect(() => {
    document.title = `${temp}Â°C, ${humidity}%, ${condition}`;
  });

  const updateWeather = () => {
    setTemp(25); // â†’ Re-render + 3 effects run
    setHumidity(60); // â†’ Re-render + 3 effects run
    setCondition('Cloudy'); // â†’ Re-render + 3 effects run
    // Total: 3 re-renders, 9 effect executions!
  };

  return (
    <div>
      <p>
        {temp}Â°C, {humidity}%, {condition}
      </p>
      <button onClick={updateWeather}>Update Weather</button>
    </div>
  );
}

// ğŸ¤” CÃ‚U Há»I DEBUG:
// 1. Bao nhiÃªu láº§n component re-render khi click button?
// 2. Bao nhiÃªu láº§n má»—i effect cháº¡y?
// 3. document.title cuá»‘i cÃ¹ng lÃ  gÃ¬?

// ğŸ’¡ GIáº¢I THÃCH:
// - 3 setState â†’ 3 re-renders (React batches trong event handler, nhÆ°ng váº«n 3 renders)
// - Má»—i render â†’ 3 effects cháº¡y
// - Effect 3 ghi Ä‘Ã¨ Effect 1 vÃ  2
// - LÃ£ng phÃ­ performance!

// âœ… CÃCH Sá»¬A #1: Gá»™p vÃ o 1 effect
function FixedWeatherV1() {
  const [temp, setTemp] = useState(20);
  const [humidity, setHumidity] = useState(50);
  const [condition, setCondition] = useState('Sunny');

  // âœ… 1 effect duy nháº¥t
  useEffect(() => {
    document.title = `${temp}Â°C, ${humidity}%, ${condition}`;
  });

  const updateWeather = () => {
    setTemp(25);
    setHumidity(60);
    setCondition('Cloudy');
  };

  return (
    <div>
      <p>
        {temp}Â°C, {humidity}%, {condition}
      </p>
      <button onClick={updateWeather}>Update Weather</button>
    </div>
  );
}

// âœ… CÃCH Sá»¬A #2: Group state (BEST)
function FixedWeatherV2() {
  const [weather, setWeather] = useState({
    temp: 20,
    humidity: 50,
    condition: 'Sunny',
  });

  // âœ… 1 state, 1 effect
  useEffect(() => {
    document.title = `${weather.temp}Â°C, ${weather.humidity}%, ${weather.condition}`;
  });

  const updateWeather = () => {
    // 1 setState â†’ 1 re-render â†’ 1 effect run
    setWeather({
      temp: 25,
      humidity: 60,
      condition: 'Cloudy',
    });
  };

  return (
    <div>
      <p>
        {weather.temp}Â°C, {weather.humidity}%, {weather.condition}
      </p>
      <button onClick={updateWeather}>Update Weather</button>
    </div>
  );
}

// ğŸ“ BÃ€I Há»ŒC:
// - Minimize sá»‘ lÆ°á»£ng effects
// - Group related state together
// - 1 effect cÃ³ thá»ƒ access nhiá»u state variables
// - Performance: Fewer re-renders = Better UX
```

---

## âœ… PHáº¦N 6: Tá»° ÄÃNH GIÃ (15 phÃºt)

### Knowledge Check

ÄÃ¡nh dáº¥u âœ… nhá»¯ng Ä‘iá»u báº¡n Ä‘Ã£ hiá»ƒu:

#### Concepts:

- [ ] TÃ´i hiá»ƒu side effect lÃ  gÃ¬
- [ ] TÃ´i biáº¿t táº¡i sao khÃ´ng nÃªn lÃ m side effects trong render
- [ ] TÃ´i hiá»ƒu useEffect cháº¡y SAU khi DOM Ä‘Ã£ update
- [ ] TÃ´i biáº¿t phÃ¢n biá»‡t useEffect vÃ  event handlers
- [ ] TÃ´i hiá»ƒu effect khÃ´ng cÃ³ dependencies cháº¡y má»—i render

#### Practices:

- [ ] TÃ´i cÃ³ thá»ƒ dÃ¹ng useEffect Ä‘á»ƒ update document.title
- [ ] TÃ´i cÃ³ thá»ƒ dÃ¹ng useEffect Ä‘á»ƒ log state changes
- [ ] TÃ´i biáº¿t khi nÃ o NÃŠN dÃ¹ng useEffect
- [ ] TÃ´i biáº¿t khi nÃ o KHÃ”NG NÃŠN dÃ¹ng useEffect
- [ ] TÃ´i trÃ¡nh Ä‘Æ°á»£c infinite loops cÆ¡ báº£n

#### Debugging:

- [ ] TÃ´i nháº­n biáº¿t Ä‘Æ°á»£c khi effect cháº¡y quÃ¡ nhiá»u láº§n
- [ ] TÃ´i hiá»ƒu táº¡i sao setState trong effect cÃ³ thá»ƒ gÃ¢y vÃ²ng láº·p
- [ ] TÃ´i biáº¿t cÃ¡ch debug báº±ng console.log trong effect
- [ ] TÃ´i cÃ³ thá»ƒ trace effect execution order

---

### Code Review Checklist

Khi review code cÃ³ useEffect, kiá»ƒm tra:

#### Timing & Logic:

- [ ] Effect cháº¡y Ä‘Ãºng thá»i Ä‘iá»ƒm (SAU render, khÃ´ng pháº£i TRONG render)
- [ ] Logic trong effect lÃ  side effect, KHÃ”NG pháº£i derived state
- [ ] KhÃ´ng cÃ³ infinite loops (setState trong effect pháº£i cáº©n tháº­n)

#### Best Practices:

- [ ] Effect code rÃµ rÃ ng, dá»… hiá»ƒu
- [ ] Comments giáº£i thÃ­ch Táº I SAO cáº§n effect
- [ ] KhÃ´ng cÃ³ duplicate effects (gá»™p logic tÆ°Æ¡ng tá»±)
- [ ] Effect Ä‘Æ¡n giáº£n, khÃ´ng quÃ¡ phá»©c táº¡p

#### Performance:

- [ ] Minimize sá»‘ lÆ°á»£ng effects
- [ ] Group related state Ä‘á»ƒ reduce re-renders
- [ ] Effect khÃ´ng cháº¡y khÃ´ng cáº§n thiáº¿t

#### Future-proof:

- [ ] Comments mention sáº½ cáº§n cleanup (NgÃ y 18)
- [ ] Chuáº©n bá»‹ cho dependencies array (NgÃ y 17)

---

## ğŸ  BÃ€I Táº¬P Vá»€ NHÃ€

### Báº¯t buá»™c (30 phÃºt)

**BÃ i 1: Greeting Message vá»›i Time of Day**

```jsx
/**
 * Táº¡o component hiá»ƒn thá»‹ lá»i chÃ o dá»±a trÃªn giá»:
 * - 5-12h: "Good Morning"
 * - 12-18h: "Good Afternoon"
 * - 18-22h: "Good Evening"
 * - 22-5h: "Good Night"
 *
 * Requirements:
 * - DÃ¹ng useEffect Ä‘á»ƒ update message má»—i phÃºt
 * - Update document.title vá»›i message
 * - Hiá»ƒn thá»‹ current time
 *
 * Hints:
 * - new Date().getHours() Ä‘á»ƒ láº¥y giá»
 * - setInterval Ä‘á»ƒ update má»—i 60 giÃ¢y
 */
```

**BÃ i 2: Click Counter vá»›i Stats**

```jsx
/**
 * Táº¡o component track clicks:
 * - Äáº¿m total clicks
 * - Äáº¿m clicks trong 5 giÃ¢y gáº§n nháº¥t (recent clicks)
 * - TÃ­nh average clicks per second
 *
 * Requirements:
 * - useEffect Ä‘á»ƒ log stats má»—i khi click
 * - Display all stats
 * - Reset button
 *
 * Hints:
 * - Store click timestamps trong array
 * - Filter clicks trong 5s: now - timestamp < 5000
 */
```

---

### NÃ¢ng cao (60 phÃºt)

**BÃ i 3: Multi-Tab Sync**

```jsx
/**
 * Táº¡o app sync state giá»¯a nhiá»u tabs:
 * - Input field cho message
 * - useEffect Ä‘á»ƒ log khi message thay Ä‘á»•i
 * - Display message
 * - Bonus: Thá»­ dÃ¹ng localStorage (tá»± research)
 *
 * Test:
 * - Má»Ÿ 2 tabs cÃ¹ng lÃºc
 * - Nháº­p message á»Ÿ tab 1
 * - Quan sÃ¡t console á»Ÿ cáº£ 2 tabs
 *
 * Challenges:
 * - localStorage.setItem() trong effect
 * - window.addEventListener('storage') (tá»± tÃ¬m hiá»ƒu)
 */
```

**BÃ i 4: Performance Monitor**

```jsx
/**
 * Táº¡o component monitor component re-renders:
 * - Track sá»‘ láº§n component render
 * - Track sá»‘ láº§n má»—i effect cháº¡y
 * - Display stats
 * - Multiple states Ä‘á»ƒ trigger re-renders
 *
 * Requirements:
 * - useEffect Ä‘á»ƒ count effect runs
 * - Compare vá»›i render count
 * - Optimize Ä‘á»ƒ reduce unnecessary effects
 *
 * Goal:
 * - Hiá»ƒu má»‘i quan há»‡ giá»¯a renders vÃ  effects
 * - Practice minimizing effects
 */
```

---

## ğŸ“š TÃ€I LIá»†U THAM KHáº¢O

### Báº¯t buá»™c Ä‘á»c

1. **React Docs - useEffect**
   - https://react.dev/reference/react/useEffect
   - Äá»c pháº§n: "useEffect is a Hook"
   - Äá»c pháº§n: "Usage"
   - Bá» QUA pháº§n cleanup vÃ  dependencies (NgÃ y 17-18)

2. **You Might Not Need an Effect**
   - https://react.dev/learn/you-might-not-need-an-effect
   - Hiá»ƒu khi nÃ o KHÃ”NG cáº§n useEffect
   - Derived state vs Effects

### Äá»c thÃªm

3. **A Complete Guide to useEffect** (Dan Abramov)
   - https://overreacted.io/a-complete-guide-to-useeffect/
   - Äá»c 30% Ä‘áº§u (basic concepts)
   - Bookmark Ä‘á»ƒ Ä‘á»c láº¡i sau NgÃ y 17-18

4. **The Lifecycle of Effects**
   - https://react.dev/learn/lifecycle-of-reactive-effects
   - Preview cho NgÃ y 17-18

---

## ğŸ”— Káº¾T Ná»I KIáº¾N THá»¨C

### Kiáº¿n thá»©c ná»n (Ä‘Ã£ há»c):

- **NgÃ y 11-12:** useState fundamentals & patterns
  - ÄÃ£ há»c: State updates trigger re-renders
  - Káº¿t ná»‘i: useEffect cháº¡y SAU re-render

- **NgÃ y 13:** Forms vá»›i State
  - ÄÃ£ há»c: Controlled components
  - Káº¿t ná»‘i: useEffect cÃ³ thá»ƒ sync form state vá»›i external systems

- **NgÃ y 14:** Lifting State Up
  - ÄÃ£ há»c: Props drilling, callback props
  - Káº¿t ná»‘i: useEffect cÃ³ thá»ƒ notify parent vá» state changes

### HÆ°á»›ng tá»›i (sáº½ há»c):

- **NgÃ y 17:** useEffect Dependencies Deep Dive
  - Sáº½ há»c: Dependencies array `[a, b]`
  - Sáº½ há»c: Khi nÃ o effect cháº¡y láº¡i
  - Sáº½ há»c: Stale closure problems

- **NgÃ y 18:** Cleanup & Memory Leaks
  - Sáº½ há»c: Return cleanup function
  - Sáº½ há»c: Prevent memory leaks
  - Sáº½ há»c: Event listener cleanup

- **NgÃ y 19-20:** Data Fetching
  - Sáº½ há»c: fetch API trong useEffect
  - Sáº½ há»c: Loading/Error states
  - Sáº½ há»c: AbortController

---

## ğŸ’¡ SENIOR INSIGHTS

### CÃ¢n Nháº¯c Production

**1. Performance Impact:**

```jsx
// âŒ BAD: Effect cháº¡y quÃ¡ nhiá»u
function Bad() {
  const [a, setA] = useState(0);
  const [b, setB] = useState(0);

  useEffect(() => {
    /* expensive operation */
  });
  useEffect(() => {
    /* expensive operation */
  });

  // Má»—i setState â†’ 2 expensive effects run!
}

// âœ… GOOD: Minimize effects
function Good() {
  const [state, setState] = useState({ a: 0, b: 0 });

  useEffect(() => {
    /* 1 expensive operation */
  });

  // 1 setState â†’ 1 effect run
}
```

**2. Debugging Strategy:**

```jsx
useEffect(() => {
  // âœ… ALWAYS log when effect runs trong development
  if (process.env.NODE_ENV === 'development') {
    console.log('Effect ran:', {
      timestamp: Date.now(),
      values: {
        /* relevant state */
      },
    });
  }

  // Your effect logic
});
```

**3. Code Organization:**

```jsx
// âœ… GOOD: Multiple focused effects
function Component() {
  // Effect 1: Document title
  useEffect(() => {
    document.title = `${title}`;
  });

  // Effect 2: Analytics
  useEffect(() => {
    trackPageView(page);
  });

  // Dá»… Ä‘á»c, dá»… maintain hÆ¡n 1 effect khá»•ng lá»“
}
```

---

### CÃ¢u Há»i Phá»ng Váº¥n

**Junior Level:**

1. **Q:** useEffect cháº¡y khi nÃ o?
   **A:** useEffect cháº¡y SAU khi component render vÃ  DOM Ä‘Ã£ Ä‘Æ°á»£c update. NÃ³ cháº¡y SAU khi user Ä‘Ã£ nhÃ¬n tháº¥y UI, khÃ´ng block browser painting.

2. **Q:** Táº¡i sao khÃ´ng nÃªn lÃ m side effects trá»±c tiáº¿p trong render?
   **A:** VÃ¬:
   - Render function pháº£i pure (predictable output tá»« inputs)
   - React cÃ³ thá»ƒ gá»i render nhiá»u láº§n
   - Side effects cáº§n kiá»ƒm soÃ¡t timing
   - useEffect cho phÃ©p React control KHI NÃ€O side effects cháº¡y

3. **Q:** PhÃ¢n biá»‡t useEffect vÃ  event handler?
   **A:**
   - useEffect: Cho side effects SYNC vá»›i state (auto, sau render)
   - Event handlers: Cho side effects tá»« USER ACTIONS (manual, khi user tÆ°Æ¡ng tÃ¡c)
   - VÃ­ dá»¥: onClick â†’ event handler, update title khi state thay Ä‘á»•i â†’ useEffect

**Mid Level:**

4. **Q:** useEffect khÃ´ng cÃ³ dependencies array khÃ¡c gÃ¬ cÃ³ empty array `[]`?
   **A:**
   - No deps: Cháº¡y SAU Má»–I render
   - Empty deps `[]`: Chá»‰ cháº¡y 1 láº§n SAU mount (NgÃ y 17)
   - With deps `[a, b]`: Cháº¡y khi a hoáº·c b thay Ä‘á»•i (NgÃ y 17)

5. **Q:** LÃ m sao trÃ¡nh infinite loop vá»›i useEffect?
   **A:**
   - KHÃ”NG call setState trong effect mÃ  KHÃ”NG cÃ³ dependencies control
   - DÃ¹ng dependencies array (NgÃ y 17) Ä‘á»ƒ limit khi nÃ o effect cháº¡y
   - Derived state thay vÃ¬ effect + setState
   - Debug báº±ng cÃ¡ch log vÃ  track re-renders

**Senior Level:**

6. **Q:** Khi nÃ o báº¡n KHÃ”NG nÃªn dÃ¹ng useEffect?
   **A:**
   - TÃ­nh toÃ¡n derived state (tÃ­nh trá»±c tiáº¿p)
   - Transform data cho rendering (dÃ¹ng useMemo sau nÃ y)
   - Handle user events (dÃ¹ng event handlers)
   - Initialize state (dÃ¹ng useState vá»›i initial value hoáº·c lazy init)
   - Chain state updates (batch trong event handler)

7. **Q:** Thiáº¿t káº¿ effect strategy cho feature phá»©c táº¡p?
   **A:**
   - TÃ¡ch effects theo concern (title, analytics, sync, etc.)
   - Group related state Ä‘á»ƒ reduce effects
   - Document WHY má»—i effect cáº§n thiáº¿t
   - Plan cleanup (NgÃ y 18)
   - Consider custom hooks Ä‘á»ƒ reuse logic (NgÃ y 24)

---

### War Stories

**Story #1: The Infinite Loop Nightmare ğŸ”¥**

> "ThÃ¡ng Ä‘áº§u lÃ m React, tÃ´i táº¡o má»™t form vá»›i useEffect Ä‘á»ƒ validate input. TÃ´i setState error message trong effect mÃ  khÃ´ng cÃ³ dependencies. Káº¿t quáº£? Browser freeze, React hiá»ƒn thá»‹ warning 'Maximum update depth exceeded'. Máº¥t 2 tiáº¿ng debug má»›i nháº­n ra effect cháº¡y má»—i render â†’ setState â†’ re-render â†’ effect cháº¡y láº¡i... Tá»« Ä‘Ã³, tÃ´i luÃ´n cáº©n tháº­n vá»›i setState trong effects!"

**Story #2: Performance Debugging**

> "Production app cháº¡y cháº­m, Chrome DevTools chá»‰ ra component re-render 50 láº§n/giÃ¢y. Thá»§ pháº¡m? 5 effects riÃªng biá»‡t track different stats, má»—i effect trigger state update â†’ cascade re-renders. Solution: Gá»™p state vÃ o 1 object, reduce tá»« 5 effects xuá»‘ng 1. Performance boost 10x. BÃ i há»c: Measure trÆ°á»›c khi optimize, nhÆ°ng cÅ©ng Ä‘á»«ng táº¡o quÃ¡ nhiá»u effects ngay tá»« Ä‘áº§u."

**Story #3: Effect vs Event Handler Confusion**

> "Junior dev trong team dÃ¹ng useEffect Ä‘á»ƒ handle button click. Code cháº¡y, nhÆ°ng logic sai: effect cháº¡y SAU render, khÃ´ng pháº£i KHI click. Káº¿t quáº£: Feature bug, user clicks khÃ´ng Ä‘Æ°á»£c process Ä‘Ãºng. Pháº£i explain: useEffect cho sync vá»›i state, event handlers cho user actions. Tá»« Ä‘Ã³, team cÃ³ convention: 'If user triggers it, use onClick. If state triggers it, use useEffect.'"

---

## ğŸ¯ NGÃ€Y MAI: useEffect - Dependencies Deep Dive

Preview nhá»¯ng gÃ¬ báº¡n sáº½ há»c:

### Dependencies Array `[]` vÃ  `[a, b]`

- Kiá»ƒm soÃ¡t KHI NÃ€O effect cháº¡y
- Empty deps: Chá»‰ 1 láº§n sau mount
- Specific deps: Cháº¡y khi deps thay Ä‘á»•i

### Stale Closure Problem

- Closures trong effects
- Táº¡i sao values cÃ³ thá»ƒ "cÅ©"
- Functional updates trong effects

### ESLint exhaustive-deps

- Linter rule giÃºp avoid bugs
- Táº¡i sao pháº£i khai bÃ¡o Ä‘áº§y Ä‘á»§ dependencies
- Exceptions vÃ  workarounds

### Best Practices

- Dependency optimization
- Object/Array dependencies
- Custom comparison

**ğŸ”¥ Chuáº©n bá»‹:**

- Ã”n láº¡i closures trong JavaScript
- LÃ m xong bÃ i táº­p vá» nhÃ  hÃ´m nay
- Suy nghÄ© vá» cÃ¡c váº¥n Ä‘á» cá»§a useEffect khÃ´ng cÃ³ deps

---

**ğŸ‰ ChÃºc má»«ng! Báº¡n Ä‘Ã£ hoÃ n thÃ nh NgÃ y 16!**

Báº¡n Ä‘Ã£:

- âœ… Hiá»ƒu Ä‘Æ°á»£c Side Effects vÃ  táº¡i sao cáº§n useEffect
- âœ… Sá»­ dá»¥ng Ä‘Æ°á»£c useEffect basic (no dependencies)
- âœ… PhÃ¢n biá»‡t Ä‘Æ°á»£c useEffect vs Event Handlers
- âœ… TrÃ¡nh Ä‘Æ°á»£c cÃ¡c lá»—i phá»• biáº¿n (infinite loops, wrong timing)
- âœ… Ãp dá»¥ng Ä‘Æ°á»£c useEffect vÃ o real-world scenarios

**Tiáº¿p tá»¥c giá»¯ Ä‘Ã ! NgÃ y 17 sáº½ má»Ÿ ra nhiá»u patterns máº¡nh máº½ hÆ¡n! ğŸš€**
